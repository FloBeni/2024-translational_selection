axis.text.x =  element_text(color="black", size=27, family="economica"),
title =  element_text(color="black", size=0, family="economica"),
legend.text =  element_text(color="black", size=25, family="economica")
) + xlab("Gene expression level (FPKM, log scale)") +
scale_x_log10(limits = c(0.01,1000),
breaks=c(0.005,0.01,0.1,0.5,1,5,10,50,100,1000,10000,50000),
labels=c(0.005,0.01,0.1,0.5,1,5,10,50,100,1000,10000,50000)) +
ylab(paste("SNPs density within introns")) + scale_fill_manual("",values=set_color_class) +
scale_color_manual("",values=set_color_class) + scale_linetype_manual("",values=set_linetype_class) +
scale_shape_manual("",values=set_shape_class) + scale_alpha_manual("",values=set_alpha_class) +
guides(fill= guide_legend(override.aes = list(size=7,pch=21,byrow = TRUE),order = 2)
) +   theme(legend.spacing.y = unit(.2, 'cm'))  + theme(legend.position='top') + annotation_logticks(sides="b")+
guides(color = FALSE, size = FALSE , linetype=F, pch=F, alpha=F) + theme(legend.position='none') + ylim(0.01,0.05)
pF
jpeg(paste(path_pannel,"p6F.jpg",sep=""), width = 6000/1, height = 3000/1,res=600/1)
print(pF)
dev.off()
# Figure 6
imgA = load.image(paste(path_require,"substitutions.png",sep="") )
imgB = load.image(paste(path_pannel,"p6B.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p6C.jpg",sep="") )
imgD = load.image(paste(path_require,"polymorphism.png",sep="") )
imgE = load.image(paste(path_pannel,"p6E.jpg",sep="") )
imgF = load.image(paste(path_pannel,"p6F.jpg",sep="") )
fly<-readPNG(paste(path_require,"Drosophila_melanogaster.png",sep=""))
{
pdf(file= paste(path_figure,"Figure6.pdf",sep=""), width=8, height=7)
m = matrix(rep(NA,10*12), nrow=12)
for(i in 1:6){
m[,i]=c(rep(1,6),rep(4,6))
}
for(i in 6:10){
m[,i]=c(rep(2,3),rep(3,3),rep(5,3),rep(6,3))
}
layout(m)
m
par(mar=c(0, 0, 0, 0))
plot(imgA, axes=FALSE)
mtext("A",at=-100,adj=-1, side=2, line=1, font=2, cex=1.7,las=2)
xaxis=570/1.1
yaxis=0/1.1
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1100/12+xaxis, ytop=-900/12+yaxis)
par(mar=c(0, 0, 1, 0))
plot(imgB, axes=FALSE)
mtext("B",at=100,adj=-0.7, side=2, line=1, font=2, cex=1.6,las=2)
par(mar=c(0, 0, 0, 0))
plot(imgC, axes=FALSE)
mtext("C",at=100,adj=-0.7, side=2, line=1, font=2, cex=1.6,las=2)
par(mar=c(0, 0, 0, 0))
plot(imgD, axes=FALSE)
mtext("D",at=-100,adj=-1, side=2, line=1, font=2, cex=1.7,las=2)
xaxis=570/1.1
yaxis=0/1.1
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1100/12+xaxis, ytop=-900/12+yaxis)
par(mar=c(0, 0, 1, 0))
plot(imgE, axes=FALSE)
mtext("E",at=100,adj=-0.7, side=2, line=1, font=2, cex=1.6,las=2)
par(mar=c(0, 0, 0, 0))
plot(imgF, axes=FALSE)
mtext("F",at=100,adj=-0.7, side=2, line=1, font=2, cex=1.6,las=2)
dev.off()
}
# Generate Supplementary Figure 6, 7, 8 & 9
source("figure/figure_main_generator/library_path.R")
set_color_class = c("#E31A1C","#33A02C")
names(set_color_class) = c( "POC -> non-POC","non-POC -> POC")
set_shape_class = c(CDS=21,intron=24)
set_linetype_class = c(CDS="solid",intron="dashed")
set_alpha_class = c(CDS=1,intron=0.5)
data_10 = read.delim("data/data10_supp.tab")
dt_graph = data_10[ data_10$group == "POCs" ,]
# Pannel B
pB = ggplot(dt_graph,aes(x=fpkm)) + ggtitle("POCs")
pB = pB +
geom_line(aes(y=simulation_density_optimal_to_nonoptimal_codon,color="POC -> non-POC",linetype='CDS',alpha='CDS'),size=1) +
geom_point(aes(y=density_optimal_to_nonoptimal_codon,fill="POC -> non-POC",pch='CDS',alpha='CDS'),size=3)+
geom_errorbar(aes(ymin=confint_low_density_optimal_to_nonoptimal_codon,
ymax=confint_high_density_optimal_to_nonoptimal_codon,color="POC -> non-POC"),
width=0.03,show.legend=FALSE) +
geom_line(aes(y=simulation_density_nonoptimal_to_optimal_codon,color="non-POC -> POC",linetype='CDS',alpha='CDS'),size=1) +
geom_point(aes(y=density_nonoptimal_to_optimal_codon,fill="non-POC -> POC",pch='CDS',alpha='CDS'),size=3)+
geom_errorbar(aes(ymin=confint_low_density_nonoptimal_to_optimal_codon,
ymax=confint_high_density_nonoptimal_to_optimal_codon,color="non-POC -> POC"),
width=0.03,show.legend=FALSE)
pB = pB + theme_bw() + theme(
axis.title.x = element_text(color="black", size=0,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=30, family="economica"),
axis.text.x =  element_text(color="black", size=0, family="economica"),
title =  element_text(color="black", size=0, family="economica"),
legend.text =  element_text(color="black", size=25, family="economica")
) + xlab("Gene expression level (FPKM, log scale)") +
scale_x_log10(limits = c(0.01,1000),
breaks=c(0.005,0.01,0.1,0.5,1,5,10,50,100,1000,10000,50000),
labels=c(0.005,0.01,0.1,0.5,1,5,10,50,100,1000,10000,50000)) +
ylab(paste("Substitution rate within CDSs")) + scale_fill_manual("",values=set_color_class) +
scale_color_manual("",values=set_color_class) + scale_linetype_manual("",values=set_linetype_class) +
scale_shape_manual("",values=set_shape_class) + scale_alpha_manual("",values=set_alpha_class) +
guides(fill= guide_legend(override.aes = list(size=7,pch=21,byrow = TRUE),order = 2)
)  + annotation_logticks(sides="b")+
guides(color = FALSE, size = FALSE , linetype=F, pch=F, alpha=F) + theme(legend.position='none') + ylim(0.005,0.04)+
theme(legend.position = c(0.8, 0.15),
legend.background = element_rect(fill="NA"),
legend.spacing.x = unit(0.5, 'cm'),
legend.spacing.y = unit(0.5, 'cm')
)
pB
jpeg(paste(path_pannel,"p6B.jpg",sep=""), width = 6000/1, height = 2800/1,res=600/1)
print(pB)
dev.off()
# Pannel C
pC = ggplot(dt_graph,aes(x=fpkm)) + ggtitle("POCs")
colnames(dt_graph)
pC = pC +
geom_line(aes(y=simulation_density_optimal_to_nonoptimal_intron,color="POC -> non-POC",linetype='intron',alpha='intron'),size=1) +
geom_point(aes(y=density_optimal_to_nonoptimal_intron,fill="POC -> non-POC",pch='intron',alpha='intron'),size=3)+
geom_errorbar(aes(ymin=confint_low_density_optimal_to_nonoptimal_intron,
ymax=confint_high_density_optimal_to_nonoptimal_intron,color="POC -> non-POC"),
width=0.03,show.legend=FALSE) +
geom_line(aes(y=simulation_density_nonoptimal_to_optimal_intron,color="non-POC -> POC",linetype='intron',alpha='intron'),size=1) +
geom_point(aes(y=density_nonoptimal_to_optimal_intron,fill="non-POC -> POC",pch='intron',alpha='intron'),size=3)+
geom_errorbar(aes(ymin=confint_low_density_nonoptimal_to_optimal_intron,
ymax=confint_high_density_nonoptimal_to_optimal_intron,color="non-POC -> POC"),
width=0.03,show.legend=FALSE)
pC = pC + theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=30, family="economica"),
axis.text.x =  element_text(color="black", size=27, family="economica"),
title =  element_text(color="black", size=0, family="economica"),
legend.text =  element_text(color="black", size=25, family="economica")
) + xlab("Gene expression level (FPKM, log scale)") +
scale_x_log10(limits = c(0.01,1000),
breaks=c(0.005,0.01,0.1,0.5,1,5,10,50,100,1000,10000,50000),
labels=c(0.005,0.01,0.1,0.5,1,5,10,50,100,1000,10000,50000)) +
ylab(paste("Substitution rate within introns")) + scale_fill_manual("",values=set_color_class) +
scale_color_manual("",values=set_color_class) + scale_linetype_manual("",values=set_linetype_class) +
scale_shape_manual("",values=set_shape_class) + scale_alpha_manual("",values=set_alpha_class) +
guides(fill= guide_legend(override.aes = list(size=7,pch=21,byrow = TRUE),order = 2)
) +   theme(legend.spacing.y = unit(.2, 'cm'))  + theme(legend.position='top') + annotation_logticks(sides="b")+
guides(color = FALSE, size = FALSE , linetype=F, pch=F, alpha=F) + theme(legend.position='none') + ylim(0.005,0.04)
pC
jpeg(paste(path_pannel,"p6C.jpg",sep=""), width = 6000/1, height = 3000/1,res=600/1)
print(pC)
dev.off()
###
data_11 = read.delim("data/data11_supp.tab")
dt_graph = data_11[ data_11$group == "POCs" ,]
# Pannel E
pE = ggplot(dt_graph,aes(x=fpkm)) + ggtitle("POCs")
pE = pE +
geom_line(aes(y=simulation_density_optimal_to_nonoptimal_codon,color="POC -> non-POC",linetype='CDS',alpha='CDS'),size=1) +
geom_point(aes(y=density_optimal_to_nonoptimal_codon,fill="POC -> non-POC",pch='CDS',alpha='CDS'),size=3)+
geom_errorbar(aes(ymin=confint_low_density_optimal_to_nonoptimal_codon,
ymax=confint_high_density_optimal_to_nonoptimal_codon,color="POC -> non-POC"),
width=0.03,show.legend=FALSE) +
geom_line(aes(y=simulation_density_nonoptimal_to_optimal_codon,color="non-POC -> POC",linetype='CDS',alpha='CDS'),size=1) +
geom_point(aes(y=density_nonoptimal_to_optimal_codon,fill="non-POC -> POC",pch='CDS',alpha='CDS'),size=3)+
geom_errorbar(aes(ymin=confint_low_density_nonoptimal_to_optimal_codon,
ymax=confint_high_density_nonoptimal_to_optimal_codon,color="non-POC -> POC"),
width=0.03,show.legend=FALSE)
pE = pE + theme_bw() + theme(
axis.title.x = element_text(color="black", size=0,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=30, family="economica"),
axis.text.x =  element_text(color="black", size=0, family="economica"),
title =  element_text(color="black", size=0, family="economica"),
legend.text =  element_text(color="black", size=25, family="economica")
) + xlab("Gene expression level (FPKM, log scale)") +
scale_x_log10(limits = c(0.01,1000),
breaks=c(0.005,0.01,0.1,0.5,1,5,10,50,100,1000,10000,50000),
labels=c(0.005,0.01,0.1,0.5,1,5,10,50,100,1000,10000,50000)) +
ylab(paste("SNPs density within CDSs")) + scale_fill_manual("",values=set_color_class) +
scale_color_manual("",values=set_color_class) + scale_linetype_manual("",values=set_linetype_class) +
scale_shape_manual("",values=set_shape_class) + scale_alpha_manual("",values=set_alpha_class) +
guides(fill= guide_legend(override.aes = list(size=7,pch=21,byrow = TRUE),order = 2)
)  + annotation_logticks(sides="b")+
guides(color = FALSE, size = FALSE , linetype=F, pch=F, alpha=F) + theme(legend.position='none') + ylim(0.01,0.05)+
theme(legend.position = c(0.8, 0.15),
legend.background = element_rect(fill="NA"),
legend.spacing.x = unit(0.5, 'cm'),
legend.spacing.y = unit(0.5, 'cm')
)
pE
jpeg(paste(path_pannel,"p6E.jpg",sep=""), width = 6000/1, height = 2800/1,res=600/1)
print(pE)
dev.off()
# Pannel F
pF = ggplot(dt_graph,aes(x=fpkm)) + ggtitle("POCs")
pF = pF +
geom_line(aes(y=simulation_density_optimal_to_nonoptimal_intron,color="POC -> non-POC",linetype='intron',alpha='intron'),size=1) +
geom_point(aes(y=density_optimal_to_nonoptimal_intron,fill="POC -> non-POC",pch='intron',alpha='intron'),size=3)+
geom_errorbar(aes(ymin=confint_low_density_optimal_to_nonoptimal_intron,
ymax=confint_high_density_optimal_to_nonoptimal_intron,color="POC -> non-POC"),
width=0.03,show.legend=FALSE) +
geom_line(aes(y=simulation_density_nonoptimal_to_optimal_intron,color="non-POC -> POC",linetype='intron',alpha='intron'),size=1) +
geom_point(aes(y=density_nonoptimal_to_optimal_intron,fill="non-POC -> POC",pch='intron',alpha='intron'),size=3)+
geom_errorbar(aes(ymin=confint_low_density_nonoptimal_to_optimal_intron,
ymax=confint_high_density_nonoptimal_to_optimal_intron,color="non-POC -> POC"),
width=0.03,show.legend=FALSE)
pF = pF + theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=30, family="economica"),
axis.text.x =  element_text(color="black", size=27, family="economica"),
title =  element_text(color="black", size=0, family="economica"),
legend.text =  element_text(color="black", size=25, family="economica")
) + xlab("Gene expression level (FPKM, log scale)") +
scale_x_log10(limits = c(0.01,1000),
breaks=c(0.005,0.01,0.1,0.5,1,5,10,50,100,1000,10000,50000),
labels=c(0.005,0.01,0.1,0.5,1,5,10,50,100,1000,10000,50000)) +
ylab(paste("SNPs density within introns")) + scale_fill_manual("",values=set_color_class) +
scale_color_manual("",values=set_color_class) + scale_linetype_manual("",values=set_linetype_class) +
scale_shape_manual("",values=set_shape_class) + scale_alpha_manual("",values=set_alpha_class) +
guides(fill= guide_legend(override.aes = list(size=7,pch=21,byrow = TRUE),order = 2)
) +   theme(legend.spacing.y = unit(.2, 'cm'))  + theme(legend.position='top') + annotation_logticks(sides="b")+
guides(color = FALSE, size = FALSE , linetype=F, pch=F, alpha=F) + theme(legend.position='none') + ylim(0.01,0.05)
pF
jpeg(paste(path_pannel,"p6F.jpg",sep=""), width = 6000/1, height = 3000/1,res=600/1)
print(pF)
dev.off()
# Figure 6
imgA = load.image(paste(path_require,"substitutions.png",sep="") )
imgB = load.image(paste(path_pannel,"p6B.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p6C.jpg",sep="") )
imgD = load.image(paste(path_require,"polymorphism.png",sep="") )
imgE = load.image(paste(path_pannel,"p6E.jpg",sep="") )
imgF = load.image(paste(path_pannel,"p6F.jpg",sep="") )
fly<-readPNG(paste(path_require,"Drosophila_melanogaster.png",sep=""))
{
pdf(file= paste(path_figure,"Figure6.pdf",sep=""), width=8, height=7)
m = matrix(rep(NA,10*12), nrow=12)
for(i in 1:6){
m[,i]=c(rep(1,6),rep(4,6))
}
for(i in 6:10){
m[,i]=c(rep(2,3),rep(3,3),rep(5,3),rep(6,3))
}
layout(m)
m
par(mar=c(0, 0, 0, 0))
plot(imgA, axes=FALSE)
mtext("A",at=-100,adj=-1, side=2, line=1, font=2, cex=1.7,las=2)
xaxis=570/1.1
yaxis=0/1.1
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1100/12+xaxis, ytop=-900/12+yaxis)
par(mar=c(0, 0, 1, 0))
plot(imgB, axes=FALSE)
mtext("B",at=100,adj=-0.7, side=2, line=1, font=2, cex=1.6,las=2)
par(mar=c(0, 0, 0, 0))
plot(imgC, axes=FALSE)
mtext("C",at=100,adj=-0.7, side=2, line=1, font=2, cex=1.6,las=2)
par(mar=c(0, 0, 0, 0))
plot(imgD, axes=FALSE)
mtext("D",at=-100,adj=-1, side=2, line=1, font=2, cex=1.7,las=2)
xaxis=570/1.1
yaxis=0/1.1
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1100/12+xaxis, ytop=-900/12+yaxis)
par(mar=c(0, 0, 1, 0))
plot(imgE, axes=FALSE)
mtext("E",at=100,adj=-0.7, side=2, line=1, font=2, cex=1.6,las=2)
par(mar=c(0, 0, 0, 0))
plot(imgF, axes=FALSE)
mtext("F",at=100,adj=-0.7, side=2, line=1, font=2, cex=1.6,las=2)
dev.off()
}
pB =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
# geom_boxplot(data=dt_graph , aes_string(x="group", y= ylabel,group="group"),outlier.shape = NA ,pch=21,fill=set_color[5],size=1)+
# geom_point(data=average_data , aes(x=x, y= y, group="moyenne"  ),pch=21,fill=set_color[7],size=8)+
# geom_errorbarh(data=average_data ,aes( xmin=x-sdx,xmax=x+sdx,x=x,y=y,group="moyenne"),height=0.02, size=1,col=set_color[7])+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1,margin = margin(t = 5)),
legend.title = element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + theme(legend.position='none') + scale_fill_manual("Clades",values=Clade_color) +
ylab("Average GC of most selected codons set\n(nnC/nnU)") +
xlab("Average per gene GCi") +   theme(legend.position = c(0.85, 0.2),
legend.background = element_rect(fill="NA"),
legend.spacing.x = unit(0.1, 'cm'),
legend.spacing.y = unit(0.1, 'cm'),
legend.box.background = element_rect(colour = "black")
)
pB
# Generate Figure 8
source("figure/figure_main_generator/library_path.R")
# Pannel 8 A
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1 = data1[data1$clade_group %in% c("Diptera","Lepidoptera"),]
dt_graph = data1
ylabel = "g_abond_ag"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pA =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste(model," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
)  + theme(legend.position='none') + scale_fill_manual(values=Clade_color) +
ylab("Average GC of most abundant tRNAs set\n(Unn/Cnn)") +
xlab("Average per gene GCi")
pA
jpeg(paste(path_pannel,"p8A.jpg",sep=""),width = 5200/2, height = 4000/2,res=700/2)
print(pA)
dev.off()
# Pannel 7 B
dt_graph = data1
ylabel = "c_duc_ic"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
average_data = data.frame(x=tapply(dt_graph[,xlabel],dt_graph[,ylabel],mean),
y=tapply(dt_graph[,ylabel],dt_graph[,ylabel],mean),
sdx=tapply(dt_graph[,xlabel],dt_graph[,ylabel],sd),
sdy=tapply(dt_graph[,ylabel],dt_graph[,ylabel],sd)
)
dt_graph[,"group"] = tapply(dt_graph[,xlabel],dt_graph[,xlabel]<=median(dt_graph[,xlabel]) , mean)[as.character(dt_graph[,xlabel]<=median(dt_graph[,xlabel]))]
x=dt_graph[dt_graph$group == unique(dt_graph$group)[1],][,ylabel]
y=dt_graph[dt_graph$group == unique(dt_graph$group)[2],][,ylabel]
wilcox.test(x,y)
t.test(x,y)
t.test(x, y, var.equal = FALSE)
pB =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
# geom_boxplot(data=dt_graph , aes_string(x="group", y= ylabel,group="group"),outlier.shape = NA ,pch=21,fill=set_color[5],size=1)+
# geom_point(data=average_data , aes(x=x, y= y, group="moyenne"  ),pch=21,fill=set_color[7],size=8)+
# geom_errorbarh(data=average_data ,aes( xmin=x-sdx,xmax=x+sdx,x=x,y=y,group="moyenne"),height=0.02, size=1,col=set_color[7])+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1,margin = margin(t = 5)),
legend.title = element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + theme(legend.position='none') + scale_fill_manual("Clades",values=Clade_color) +
ylab("Average GC of most selected codons set\n(nnC/nnU)") +
xlab("Average per gene GCi") +   theme(legend.position = c(0.85, 0.2),
legend.background = element_rect(fill="NA"),
legend.spacing.x = unit(0.1, 'cm'),
legend.spacing.y = unit(0.1, 'cm'),
legend.box.background = element_rect(colour = "black")
)
pB
pB =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
# geom_boxplot(data=dt_graph , aes_string(x="group", y= ylabel,group="group"),outlier.shape = NA ,pch=21,fill=set_color[5],size=1)+
# geom_point(data=average_data , aes(x=x, y= y, group="moyenne"  ),pch=21,fill=set_color[7],size=8)+
# geom_errorbarh(data=average_data ,aes( xmin=x-sdx,xmax=x+sdx,x=x,y=y,group="moyenne"),height=0.02, size=1,col=set_color[7])+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1,margin = margin(t = 5)),
legend.title = element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + theme(legend.position='none') + scale_fill_manual("Clades",values=Clade_color) +
ylab("Average GC of most selected codons set\n(nnC/nnU)") +
xlab("Average per gene GCi") +   theme(legend.position = c(0.85, 0.2),
legend.background = element_rect(fill="NA"),
legend.spacing.x = unit(0.1, 'cm'),
legend.spacing.y = unit(0.1, 'cm'),
legend.box.background = element_rect(colour = "black")
)
pB
# Generate Figure 8
source("figure/figure_main_generator/library_path.R")
# Pannel 8 A
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1 = data1[data1$clade_group %in% c("Diptera","Lepidoptera"),]
dt_graph = data1
ylabel = "g_abond_ag"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pA =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste(model," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
)  + theme(legend.position='none') + scale_fill_manual(values=Clade_color) +
ylab("Average GC of most abundant tRNAs set\n(Unn/Cnn)") +
xlab("Average per gene GCi")
pA
jpeg(paste(path_pannel,"p8A.jpg",sep=""),width = 5200/2, height = 4000/2,res=700/2)
print(pA)
dev.off()
# Pannel 7 B
dt_graph = data1
ylabel = "c_duc_ic"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
average_data = data.frame(x=tapply(dt_graph[,xlabel],dt_graph[,ylabel],mean),
y=tapply(dt_graph[,ylabel],dt_graph[,ylabel],mean),
sdx=tapply(dt_graph[,xlabel],dt_graph[,ylabel],sd),
sdy=tapply(dt_graph[,ylabel],dt_graph[,ylabel],sd)
)
dt_graph[,"group"] = tapply(dt_graph[,xlabel],dt_graph[,xlabel]<=median(dt_graph[,xlabel]) , mean)[as.character(dt_graph[,xlabel]<=median(dt_graph[,xlabel]))]
x=dt_graph[dt_graph$group == unique(dt_graph$group)[1],][,ylabel]
y=dt_graph[dt_graph$group == unique(dt_graph$group)[2],][,ylabel]
wilcox.test(x,y)
t.test(x,y)
t.test(x, y, var.equal = FALSE)
pB =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
# geom_boxplot(data=dt_graph , aes_string(x="group", y= ylabel,group="group"),outlier.shape = NA ,pch=21,fill=set_color[5],size=1)+
# geom_point(data=average_data , aes(x=x, y= y, group="moyenne"  ),pch=21,fill=set_color[7],size=8)+
# geom_errorbarh(data=average_data ,aes( xmin=x-sdx,xmax=x+sdx,x=x,y=y,group="moyenne"),height=0.02, size=1,col=set_color[7])+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1,margin = margin(t = 5)),
legend.title = element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + theme(legend.position='none') + scale_fill_manual("Clades",values=Clade_color) +
ylab("Average GC of most selected codons set\n(nnC/nnU)") +
xlab("Average per gene GCi") +   theme(legend.position = c(0.85, 0.2),
legend.background = element_rect(fill="NA"),
legend.spacing.x = unit(0.1, 'cm'),
legend.spacing.y = unit(0.1, 'cm'),
legend.box.background = element_rect(colour = "black")
)
pB
jpeg(paste(path_pannel,"p8B.jpg",sep=""),width = 5200/2, height = 4000/2,res=700/2)
print(pB)
dev.off()
# Figure 7
imgA = load.image(paste(path_pannel,"p8A.jpg",sep="") )
imgB = load.image(paste(path_pannel,"p8B.jpg",sep="") )
imgC = load.image(paste(path_require,"hypothesis.png",sep=""))
fly<-readPNG(paste(path_require,"fly.png",sep=""))
{
pdf(file= paste(path_figure,"Figure8.pdf",sep=""), width=10, height=8*2/2)
m = matrix(rep(NA,2*2), nrow=2)
m[1,]=c(1,2)
m[2,]=c(3,3)
layout(m)
par(mar=c(0,2, 2, 0))
plot(imgA, axes=FALSE)
mtext("A",at=-100,adj=0, side=2, line=1, font=2, cex=2,las=2)
xaxis=2230
yaxis=150
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/5+xaxis, ytop=-900/5+yaxis)
plot(imgB, axes=FALSE)
mtext("B",at=-100,adj=0, side=2, line=1, font=2, cex=2,las=2)
xaxis=2230
yaxis=150
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/5+xaxis, ytop=-900/5+yaxis)
par(mar=c(0, 1, 0, 1))
plot(imgC, axes=FALSE)
mtext("C",at=100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
dev.off()
}
