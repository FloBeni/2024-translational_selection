dt_graph[dt_graph$amino_acid == "Trp (1)",]$Prop = NA
dt_graph$categorie
ggplot(dt_graph, aes(x = "" , y = Prop, fill = fct_inorder(categorie)))
library(stringi)
library(ggplot2)
library(seqinr)
library(stringr)
library(ape)
library(patchwork)
library(png)
library(ggtree)
library(caper)
library(ggExtra)
library(phylolm)
library(imager)
library(ggplot2)
library(RColorBrewer)
library(stringi)
library(forcats)
library(scales)
p3A = ggplot(dt_graph, aes(x = "" , y = Prop, fill = fct_inorder(categorie))) +
geom_col(width = 1, color = 1) +
coord_polar(theta = "y") + facet_wrap(~title+paste(amino_acid),nrow=4,dir="v")+
theme_void() + theme(
title =  element_text(size=36, family="economica"),
legend.text =  element_text(color="black", size=40, family="economica",vjust = 1.5,margin = margin(t = 10)),
strip.text = element_text(size=30, family="economica",face="bold"),
legend.spacing.x = unit(1, 'cm'),
legend.position="right",
legend.key.size= unit(1, "cm"),
legend.box.margin=margin(l=50),
plot.title = element_text(hjust = 0.5,margin = margin(0,0,20,0))
)  +
## important additional element
guides(fill = guide_legend(byrow = TRUE))+
# scale_fill_manual("",values = c("#33A02C","#B2DF8A","#FF7F00","#FDBF6F","#FB9A99","#E31A1C"))  +
scale_fill_manual("",values = c("#FB9A99","#B2DF8A","#FF7F00","#FDBF6F","#FB9A99","#E31A1C"))
# ggtitle(paste("Mecopterida"," (",dt_graph$total[1],")",sep=""))
p3A
p3A = ggplot(dt_graph, aes(x = "" , y = Prop, fill = fct_inorder(categorie))) +
geom_col(width = 1, color = 1) +
coord_polar(theta = "y") + facet_wrap(~title+paste(amino_acid),nrow=4,dir="v")+
theme_void() + theme(
title =  element_text(size=36, family="economica"),
legend.text =  element_text(color="black", size=40, family="economica",vjust = 1.5,margin = margin(t = 10)),
strip.text = element_text(size=30, family="economica",face="bold"),
legend.spacing.x = unit(1, 'cm'),
legend.position="right",
legend.key.size= unit(1, "cm"),
legend.box.margin=margin(l=50),
plot.title = element_text(hjust = 0.5,margin = margin(0,0,20,0))
)  +
## important additional element
guides(fill = guide_legend(byrow = TRUE))+
# scale_fill_manual("",values = c("#33A02C","#B2DF8A","#FF7F00","#FDBF6F","#FB9A99","#E31A1C"))  +
scale_fill_manual("",values = c("#33A02C","#B2DF8A","#FB9A99"))
# ggtitle(paste("Mecopterida"," (",dt_graph$total[1],")",sep=""))
p3A
{
p3A = ggplot(dt_graph, aes(x = "" , y = Prop, fill = fct_inorder(categorie))) +
geom_col(width = 1, color = 1) +
coord_polar(theta = "y") + facet_wrap(~title+paste(amino_acid),nrow=4,dir="v")+
theme_void() + theme(
title =  element_text(size=36, family="economica"),
legend.text =  element_text(color="black", size=40, family="economica",vjust = 1.5,margin = margin(t = 10)),
strip.text = element_text(size=30, family="economica",face="bold"),
legend.spacing.x = unit(1, 'cm'),
legend.position="right",
legend.key.size= unit(1, "cm"),
legend.box.margin=margin(l=50),
plot.title = element_text(hjust = 0.5,margin = margin(0,0,20,0))
)  +
## important additional element
guides(fill = guide_legend(byrow = TRUE))+
scale_fill_manual("",values = c("#33A02C","#B2DF8A","#FB9A99"))
# ggtitle(paste("Mecopterida"," (",dt_graph$total[1],")",sep=""))
p3A
jpeg(paste(path_pannel,"p3_DUC.jpg",sep=""), width = 10000/1,  3600/1,res=300/1)
print(p3A)
dev.off()
}
# Generate Figure 4
source("figure/figure_main_generator/library_path.R")
# Pannel 4 A
data5 = read.delim("data/data5_supp.tab")
data5$set = str_replace_all(data5$set,"all,","genes,")
dt_graph = data5[ data5$species == "Homo_sapiens" & grepl("Wb_WC_notambiguous",data5$type_aa) ,]
pA = ggplot(dt_graph ,
aes(x=fpkm ,y=freq*100,fill=categorie,col=categorie))  + geom_point(alpha=0)+
geom_line(data=dt_graph,size=2) +
geom_point(data=dt_graph,pch=21,col="black",size=4)+
scale_fill_manual(values=set_color) +
scale_color_manual(values=set_color) +
scale_shape_manual(values=c(21,22,24,23,25,20))+
xlab("Gene expression level (FPKM, log scale)") + ylab("Codon set frequency (%)") + theme_bw() + theme(
axis.title.x = element_text(color="black", size=25,family="economica"),
axis.title.y = element_text(color="black", size=25, family="economica"),
axis.text.y =  element_text(color="black", size=23, family="economica"),
axis.text.x =  element_text(color="black", size=23, family="economica"),
title =  element_text(color="black", size=27, family="economica"),
legend.text =  element_text(color="black", size=25, family="economica"),
strip.text = element_text(size=15)
)+labs(fill='Categories',color='Categories',shape='',linetype='')+
guides(fill = guide_legend(override.aes = list(pch=NA),order = 1),
color = guide_legend(order = 1),
linetype = guide_legend(order = 2),
shape = guide_legend(order = 2),
) + scale_x_log10(
breaks=c(0.005,0.01,0.1,1,10,100,500,1000,10000,50000),
labels=c(0.005,0.01,0.1,1,10,100,500,1000,10000,50000)) + ylim(0.3*100,0.7*100) +
geom_hline(yintercept = mean(dt_graph[dt_graph$fpkm <= median(dt_graph$fpkm) & !grepl("POCMT",dt_graph$categorie),]$freq)*100,size=1,linetype="dashed",col="#E31A1C") +
geom_hline(yintercept = mean(dt_graph[dt_graph$fpkm <= median(dt_graph$fpkm) & grepl("POCMT",dt_graph$categorie),]$freq)*100,size=1,linetype="dashed",col="#FB9A99") +
geom_point(data =  dt_graph[!grepl("POCMT",dt_graph$categorie) & dt_graph$fpkm == max(dt_graph$fpkm) , ],col="black",pch=21,fill="#E31A1C",size=6)+
geom_point(data = dt_graph[grepl("POCMT",dt_graph$categorie) & dt_graph$fpkm == max(dt_graph$fpkm) , ],col="black",pch=21,fill="#FB9A99",size=6)+
ggtitle(paste(unique(dt_graph$set)," genes",sep="")) +   guides(fill="none",color="none",linetype="none",shape="none")+ annotation_logticks(sides = "b")
pA
jpeg(paste(path_pannel,"p4A.jpg",sep=""),  width = 7500/2,  5400/2,res=900/1.8)
print(pA)
dev.off()
# Pannel 4 B
dt_graph = data5[ data5$species == "Caenorhabditis_elegans" & grepl("Wb_WC_notambiguous",data5$type_aa) ,]
pB = ggplot(dt_graph ,
aes(x=fpkm ,y=freq*100,fill=categorie,col=categorie))  + geom_point(alpha=0)+
geom_line(data=dt_graph,size=2) +
geom_point(data=dt_graph,pch=21,col="black",size=4)+
scale_fill_manual(values=set_color) +
scale_color_manual(values=set_color) +
scale_shape_manual(values=c(21,22,24,23,25,20))+
xlab("Gene expression level (FPKM, log scale)") + ylab("Codon set frequency (%)") + theme_bw() + theme(
axis.title.x = element_text(color="black", size=25,family="economica"),
axis.title.y = element_text(color="black", size=25, family="economica"),
axis.text.y =  element_text(color="black", size=23, family="economica"),
axis.text.x =  element_text(color="black", size=23, family="economica"),
title =  element_text(color="black", size=27, family="economica"),
legend.text =  element_text(color="black", size=25, family="economica",vjust = 1.5,margin = margin(t = 10)),
strip.text = element_text(size=15)
)+labs(fill='Categories',color='Categories',shape='',linetype='')+
guides(fill = guide_legend(override.aes = list(pch=NA),order = 1),
color = guide_legend(order = 1),
linetype = guide_legend(order = 2),
shape = guide_legend(order = 2),
)+          scale_x_log10(
breaks=c(0.005,0.01,0.1,1,10,100,500,1000,10000,50000),
labels=c(0.005,0.01,0.1,1,10,100,500,1000,10000,50000))+ ylim(0.3*100,0.7*100) +
geom_hline(yintercept = mean(dt_graph[dt_graph$fpkm <= median(dt_graph$fpkm) & !grepl("POCMT",dt_graph$categorie),]$freq)*100,size=1,linetype="dashed",col="#E31A1C") +
geom_hline(yintercept = mean(dt_graph[dt_graph$fpkm <= median(dt_graph$fpkm) & grepl("POCMT",dt_graph$categorie),]$freq)*100,size=1,linetype="dashed",col="#FB9A99") +
geom_point(data =  dt_graph[!grepl("POCMT",dt_graph$categorie) & dt_graph$fpkm == max(dt_graph$fpkm) , ],col="black",pch=21,fill="#E31A1C",size=6)+
geom_point(data = dt_graph[grepl("POCMT",dt_graph$categorie) & dt_graph$fpkm == max(dt_graph$fpkm) , ],col="black",pch=21,fill="#FB9A99",size=6)+
ggtitle(paste(unique(dt_graph$set)," genes",sep="")) +   guides(linetype="none",shape="none")+ annotation_logticks(sides = "b")
pB
jpeg(paste(path_pannel,"p4B.jpg",sep=""),  width = 12000/2,  5500/2,res=900/1.8)
print(pB)
dev.off()
# Pannel 4 C
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0 & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000,]
pC = ggplot(data1,aes(y=expressed_overused_background_WB_WC_notambiguous,x=clade_group,fill=clade_group,label=species))  +
geom_hline(size=1,linetype="dashed",col="red", yintercept = 0 ) +
geom_boxplot(alpha=.1) +
geom_point(aes(fill=clade_group),size=3,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black",angle = 50, size=25,family="economica"),
axis.title.y = element_text(color="black", size=25, family="economica",margin = margin(t = 0, r = 20, b = 0, l = 0)),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black",vjust=.5, size=0,angle = 50, family="economica"),
title =  element_text(color="black", size=0, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica")
) + theme(legend.position='none') + scale_fill_manual(values=Clade_color) +
ylab("Difference in proportion of POC between\nthe top 5% and bottom 50% expressed (%)")  + xlab("")  + ylim(-5,20)
pC = ggMarginal(pC, type="histogram",fill=set_color[1])
pC
jpeg(paste(path_pannel,"p4C.jpg",sep=""), width = 5500/1, height = 3000/1,res=460/1)
print(pC)
dev.off()
# Figure 4
imgA = load.image(paste(path_pannel,"p4A.jpg",sep="") )
imgB = load.image(paste(path_pannel,"p4B.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p4C.jpg",sep="") )
human<-readPNG(paste(path_require,"human.png",sep=""))
Caenorhabditis_elegans = readPNG(paste(path_require,"Caenorhabditis_elegans.png",sep=""))
Drosophila_melanogaster = readPNG(paste(path_require,"Drosophila_melanogaster.png",sep=""))
clade_png<-readPNG(paste(path_require,"clade.png",sep=""))
{
pdf(file= paste(path_figure,"Figure4.pdf",sep=""), width=9, height=6)
m = matrix(rep(NA,100*10), nrow=10)
for(i in 1:5){
m[i,]=c(rep(1,45),rep(2,55))
}
for(i in 5:10){
m[i,]=c(rep(3,10))
}
layout(m)
par(mar=c(0, 0, 1, 0))
plot(imgA, axes=FALSE)
mtext("A",at=100,adj=-1, side=2, line=1, font=2, cex=1.7,las=2)
xhuman=470
yhuman=-350
rasterImage(human,xleft=0+xhuman, ybottom=450/.9-yhuman, xright=190/.9+xhuman, ytop=0-yhuman)
par(mar=c(0, 0, 1, 0))
plot(imgB, axes=FALSE)
mtext("B",at=100,adj=0.5, side=2, line=1, font=2, cex=1.7,las=2)
xcel=500
ycel=-350
rasterImage(Caenorhabditis_elegans,xleft=0+xcel, ybottom=350/1.5-ycel, xright=1000/1.5+xcel, ytop=0-ycel)
par(mar=c(1,12, 0, 13))
plot(imgC, axes=FALSE)
mtext("C",at=200,adj=1, side=2, line=1, font=2, cex=1.7,las=2)
par(mar=c(1,0, 0, 0))
xmonkey=5500
ymonkey=500
rasterImage(clade_png,xleft=0+xmonkey, ybottom=800/.4+ymonkey, xright=500/.4+xmonkey, ytop=ymonkey)
dev.off()
}
data4$categorie = factor(data4$group,levels =  c("Best DUC","DUC","not DUC"))
dt_graph = data4
vect_debut = c("AT","GT","AC","GC","GG","CC","TC","AG","CG","CT","TT","AA","GA","CA","TG","TA")
dt_graph$codon = factor(dt_graph$codon,levels =  unlist(lapply(vect_debut,function(x) paste(x,c("C","T","A","G"),sep=""))) )
dt_graph$title = factor(paste(dt_graph$codon,sep=""),
sapply(levels(dt_graph$codon),function(x) paste(x,sep="")) )
dt_graph[dt_graph$amino_acid == "Ter (3)",]$Prop = NA
dt_graph[dt_graph$amino_acid == "Met (1)",]$Prop = NA
dt_graph[dt_graph$amino_acid == "Trp (1)",]$Prop = NA
{
p3A = ggplot(dt_graph, aes(x = "" , y = Prop, fill = fct_inorder(categorie))) +
geom_col(width = 1, color = 1) +
coord_polar(theta = "y") + facet_wrap(~title+paste(amino_acid),nrow=4,dir="v")+
theme_void() + theme(
title =  element_text(size=36, family="economica"),
legend.text =  element_text(color="black", size=40, family="economica",vjust = 1.5,margin = margin(t = 10)),
strip.text = element_text(size=30, family="economica",face="bold"),
legend.spacing.x = unit(1, 'cm'),
legend.position="right",
legend.key.size= unit(1, "cm"),
legend.box.margin=margin(l=50),
plot.title = element_text(hjust = 0.5,margin = margin(0,0,20,0))
)  +
## important additional element
guides(fill = guide_legend(byrow = TRUE))+
scale_fill_manual("",values = c("#33A02C","#B2DF8A","#FB9A99"))
# ggtitle(paste("Mecopterida"," (",dt_graph$total[1],")",sep=""))
p3A
jpeg(paste(path_pannel,"p3_DUC.jpg",sep=""), width = 10000/1,  3600/1,res=300/1)
print(p3A)
dev.off()
}
# Generate Figure 7
source("figure/figure_main_generator/library_path.R")
# Pannel 7 A
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1 = data1[data1$clade_group == "Mecopterida",]
dt_graph = data1
ylabel = "gc_abond_ag"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
# Generate Figure 7
source("figure/figure_main_generator/library_path.R")
# Pannel 7 A
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1 = data1[data1$clade_group == "Mecopterida",]
dt_graph = data1
ylabel = "gc_abond_ag"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
# Generate Figure 7
source("figure/figure_main_generator/library_path.R")
# Pannel 7 A
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1 = data1[data1$clade_group == "Mecopterida",]
dt_graph = data1
ylabel = "g_abond_ag"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
lm_y = dt_graph[,ylabel]
lm_x = dt_graph[,xlabel]
shorebird <- comparative.data(arbrePhylo,
data.frame(species = dt_graph$species,
pgls_x = lm_x,
pgls_y = lm_y), species, vcv=TRUE)
pA =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste("LM: "," R"^2,lm_eqn), list(nbspecies=nrow(dt_graph),
lm_eqn=lm_eqn(lm(lm_y ~ lm_x)),
pgls_eq=lm_eqn(pgls(pgls_y~pgls_x,shorebird))))
)  + theme(legend.position='none') + scale_fill_manual(values=Clade_color) +
ylab("Average GC of most abundant tRNAs A/G") +
xlab("Average per gene GCi")
pA
jpeg(paste(path_pannel,"F7pA.jpg",sep=""),width = 5200/2, height = 4000/2,res=700/2)
print(pA)
dev.off()
# Pannel 7 B
dt_graph = data1
ylabel = "gc_duc"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
lm_y = dt_graph[,ylabel]
lm_x = dt_graph[,xlabel]
shorebird <- comparative.data(arbrePhylo,
data.frame(species=dt_graph$species,
pgls_x=lm_x,
pgls_y=lm_y), species, vcv=TRUE)
average_data = data.frame(x=tapply(dt_graph[,xlabel],dt_graph[,ylabel],mean),
y=tapply(dt_graph[,ylabel],dt_graph[,ylabel],mean),
sdx=tapply(dt_graph[,xlabel],dt_graph[,ylabel],sd),
sdy=tapply(dt_graph[,ylabel],dt_graph[,ylabel],sd)
)
dt_graph[,"group"] = tapply(dt_graph[,xlabel],dt_graph[,xlabel]<=median(dt_graph[,xlabel]) , mean)[as.character(dt_graph[,xlabel]<=median(dt_graph[,xlabel]))]
x=dt_graph[dt_graph$group == unique(dt_graph$group)[1],][,ylabel]
y=dt_graph[dt_graph$group == unique(dt_graph$group)[2],][,ylabel]
wilcox.test(x,y)
t.test(x,y)
t.test(x, y, var.equal = FALSE)
pB =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_boxplot(data=dt_graph , aes_string(x="group", y= ylabel,group="group"),outlier.shape = NA ,pch=21,fill=set_color[5],size=1)+
# geom_point(data=average_data , aes(x=x, y= y, group="moyenne"  ),pch=21,fill=set_color[7],size=8)+
# geom_errorbarh(data=average_data ,aes( xmin=x-sdx,xmax=x+sdx,x=x,y=y,group="moyenne"),height=0.02, size=1,col=set_color[7])+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste("LM: "," R"^2,lm_eqn), list(nbspecies=nrow(dt_graph),
lm_eqn=lm_eqn(lm(lm_y ~ lm_x)),
pgls_eq=lm_eqn(pgls(pgls_y~pgls_x,shorebird))))
) + theme(legend.position='none') + scale_fill_manual(values=Clade_color) +
ylab("Average GC of most selected codon set") +
xlab("Average per gene GCi")
pB
jpeg(paste(path_pannel,"F7pB.jpg",sep=""),width = 5200/2, height = 4000/2,res=700/2)
print(pB)
dev.off()
# Figure 7
imgA = load.image(paste(path_pannel,"F7pA.jpg",sep="") )
imgB = load.image(paste(path_pannel,"F7pB.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p3_DUC.jpg",sep=""))
imgD = load.image(paste(path_require,"hypothesis.png",sep=""))
fly<-readPNG(paste(path_require,"fly.png",sep=""))
{
pdf(file= paste(path_figure,"Figure7.pdf",sep=""), width=10, height=8*3/2)
m = matrix(rep(NA,2*3), nrow=3)
m[1,]=c(1,2)
m[2,]=c(3,3)
m[3,]=c(4,4)
layout(m)
par(mar=c(0,2, 2, 0))
plot(imgA, axes=FALSE)
mtext("A",at=-100,adj=0, side=2, line=1, font=2, cex=2,las=2)
xaxis=2230
yaxis=1430
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/4.5+xaxis, ytop=-900/4.5+yaxis)
plot(imgB, axes=FALSE)
mtext("B",at=-100,adj=0, side=2, line=1, font=2, cex=2,las=2)
xaxis=2230
yaxis=1430
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/4.5+xaxis, ytop=-900/4.5+yaxis)
par(mar=c(0, 1, 0, 1))
plot(imgC, axes=FALSE)
mtext("C",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,2, 2, 0))
plot(imgD, axes=FALSE)
mtext("D",at=10,adj=-3, side=2, line=1, font=2, cex=2,las=2)
dev.off()
}
# Generate Figure 7
source("figure/figure_main_generator/library_path.R")
# Pannel 7 A
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1 = data1[data1$clade_group == "Mecopterida",]
dt_graph = data1
ylabel = "g_abond_ag"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
lm_y = dt_graph[,ylabel]
lm_x = dt_graph[,xlabel]
shorebird <- comparative.data(arbrePhylo,
data.frame(species = dt_graph$species,
pgls_x = lm_x,
pgls_y = lm_y), species, vcv=TRUE)
pA =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste("LM: "," R"^2,lm_eqn), list(nbspecies=nrow(dt_graph),
lm_eqn=lm_eqn(lm(lm_y ~ lm_x)),
pgls_eq=lm_eqn(pgls(pgls_y~pgls_x,shorebird))))
)  + theme(legend.position='none') + scale_fill_manual(values=Clade_color) +
ylab("Average GC of most abundant tRNAs A/G") +
xlab("Average per gene GCi") +
labs(
caption = substitute(paste("LM: "," R"^2,lm_eqn," / PGLS:"," R"^2,pgls_eq), list(nbspecies=nrow(dt_graph),
lm_eqn=lm_eqn(lm(lm_y ~ lm_x)),
pgls_eq=lm_eqn(pgls(pgls_y~pgls_x,shorebird)))),
)
pA
jpeg(paste(path_pannel,"F7pA.jpg",sep=""),width = 5200/2, height = 4000/2,res=700/2)
print(pA)
dev.off()
# Pannel 7 B
dt_graph = data1
ylabel = "c_duc_ic"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
lm_y = dt_graph[,ylabel]
lm_x = dt_graph[,xlabel]
shorebird <- comparative.data(arbrePhylo,
data.frame(species=dt_graph$species,
pgls_x=lm_x,
pgls_y=lm_y), species, vcv=TRUE)
average_data = data.frame(x=tapply(dt_graph[,xlabel],dt_graph[,ylabel],mean),
y=tapply(dt_graph[,ylabel],dt_graph[,ylabel],mean),
sdx=tapply(dt_graph[,xlabel],dt_graph[,ylabel],sd),
sdy=tapply(dt_graph[,ylabel],dt_graph[,ylabel],sd)
)
dt_graph[,"group"] = tapply(dt_graph[,xlabel],dt_graph[,xlabel]<=median(dt_graph[,xlabel]) , mean)[as.character(dt_graph[,xlabel]<=median(dt_graph[,xlabel]))]
x=dt_graph[dt_graph$group == unique(dt_graph$group)[1],][,ylabel]
y=dt_graph[dt_graph$group == unique(dt_graph$group)[2],][,ylabel]
wilcox.test(x,y)
t.test(x,y)
t.test(x, y, var.equal = FALSE)
pB =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_boxplot(data=dt_graph , aes_string(x="group", y= ylabel,group="group"),outlier.shape = NA ,pch=21,fill=set_color[5],size=1)+
# geom_point(data=average_data , aes(x=x, y= y, group="moyenne"  ),pch=21,fill=set_color[7],size=8)+
# geom_errorbarh(data=average_data ,aes( xmin=x-sdx,xmax=x+sdx,x=x,y=y,group="moyenne"),height=0.02, size=1,col=set_color[7])+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste("LM: "," R"^2,lm_eqn), list(nbspecies=nrow(dt_graph),
lm_eqn=lm_eqn(lm(lm_y ~ lm_x)),
pgls_eq=lm_eqn(pgls(pgls_y~pgls_x,shorebird))))
) + theme(legend.position='none') + scale_fill_manual(values=Clade_color) +
ylab("Average GC of most selected codon set\n(NNC decoded through I:C WBp and NNU)") +
xlab("Average per gene GCi")
pB
jpeg(paste(path_pannel,"F7pB.jpg",sep=""),width = 5200/2, height = 4000/2,res=700/2)
print(pB)
dev.off()
# Figure 7
imgA = load.image(paste(path_pannel,"F7pA.jpg",sep="") )
imgB = load.image(paste(path_pannel,"F7pB.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p3_DUC.jpg",sep=""))
imgD = load.image(paste(path_require,"hypothesis.png",sep=""))
fly<-readPNG(paste(path_require,"fly.png",sep=""))
{
pdf(file= paste(path_figure,"Figure7.pdf",sep=""), width=10, height=8*3/2)
m = matrix(rep(NA,2*3), nrow=3)
m[1,]=c(1,2)
m[2,]=c(3,3)
m[3,]=c(4,4)
layout(m)
par(mar=c(0,2, 2, 0))
plot(imgA, axes=FALSE)
mtext("A",at=-100,adj=0, side=2, line=1, font=2, cex=2,las=2)
xaxis=2230
yaxis=1430
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/4.5+xaxis, ytop=-900/4.5+yaxis)
plot(imgB, axes=FALSE)
mtext("B",at=-100,adj=0, side=2, line=1, font=2, cex=2,las=2)
xaxis=2230
yaxis=1430
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/4.5+xaxis, ytop=-900/4.5+yaxis)
par(mar=c(0, 1, 0, 1))
plot(imgC, axes=FALSE)
mtext("C",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,2, 2, 0))
plot(imgD, axes=FALSE)
mtext("D",at=10,adj=-3, side=2, line=1, font=2, cex=2,las=2)
dev.off()
}
