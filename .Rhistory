<<<<<<< HEAD
axis.text.y =  element_text(color="black", size=25, family="economica"),
axis.text.x =  element_text(color="black", size=25, family="economica"),
title =  element_text(color="black", size=16, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab("GC3 rate per gene") + ylab("Number of genes") +
ggtitle(paste("N=",format(nrow(dt_graph),big.mark=",",scientific=T),"housekeeping genes")) +
lim(0,1)
dev.off()
dev.off()
dev.off()
dev.off()
# Generate Figure 9
source("figure/figure_main_generator/library_path.R")
data2 = read.delim("data/data2_supp.tab")
dt_graph = data2[data2$species == "Homo_sapiens" ,]
# Pannel 9 A
pA = ggplot(dt_graph , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=80,size=0.2)+ theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=25, family="economica"),
axis.text.x =  element_text(color="black", size=25, family="economica"),
title =  element_text(color="black", size=16, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab("GC3 rate per gene") + ylab("Number of genes") + ggtitle(paste("All genes, N=",format(nrow(dt_graph),big.mark=",",scientific=T))) + xlim(0,1)
pA
jpeg(paste(path_pannel,"p9A.jpg",sep=""),
width = 6000/4.5,  5000/4,res=1000/4)
print(pA)
dev.off()
# Pannel 9 B
# Load data on gene features + meiotic expression from Pouyet et al. 2017
D=read.table(file="data/human_genes_summary", header = TRUE)
# Load data on somatic expression from Pouyet et al. 2017
EF=read.table(file="data/human_genes_expression_in_tissues", header = TRUE)
merge_dt = merge.data.frame(x=D,y=EF,by="Ensembl.Gene.ID")
top_quantile = 0.8
ltissue = names(merge_dt)[39:65]
merge_dt$NbTissueTopExp = 0
for(tissue in ltissue) {
qX=quantile(merge_dt[,tissue], probs = top_quantile, na.rm=TRUE)
lsel=which(merge_dt[,tissue]>qX)
merge_dt$NbTissueTopExp[lsel]=merge_dt$NbTissueTopExp[lsel]+1
}
dt_graph=merge_dt[which(merge_dt$NbTissueTopExp>20),]
# pB = ggplot(dt_graph[dt_graph$gene_expression >= quantile(dt_graph$gene_expression,0.80),] , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50)+ theme_bw() + theme(
pB = ggplot(dt_graph , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50,size=0.2)+ theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=25, family="economica"),
axis.text.x =  element_text(color="black", size=25, family="economica"),
title =  element_text(color="black", size=16, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab("GC3 rate per gene") + ylab("Number of genes") +
ggtitle(paste("N=",format(nrow(dt_graph),big.mark=",",scientific=T),"housekeeping genes")) +
lim(0,1)
nrow(dt_graph)
# pB = ggplot(dt_graph[dt_graph$gene_expression >= quantile(dt_graph$gene_expression,0.80),] , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50)+ theme_bw() + theme(
pB = ggplot(dt_graph , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50,size=0.2)+ theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=25, family="economica"),
axis.text.x =  element_text(color="black", size=25, family="economica"),
title =  element_text(color="black", size=16, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab("GC3 rate per gene") + ylab("Number of genes") +
ggtitle(paste("N=",format(nrow(dt_graph),big.mark=",",scientific=T),"housekeeping genes")) +
lim(0,1)
# pB = ggplot(dt_graph[dt_graph$gene_expression >= quantile(dt_graph$gene_expression,0.80),] , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50)+ theme_bw() + theme(
pB = ggplot(dt_graph , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50,size=0.2)+ theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=25, family="economica"),
axis.text.x =  element_text(color="black", size=25, family="economica"),
title =  element_text(color="black", size=16, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab("GC3 rate per gene") + ylab("Number of genes") +
ggtitle(paste("N=",format(nrow(dt_graph),big.mark=",",scientific=T),"housekeeping genes")) +
xlim(0,1)
pB
# Generate Figure 9
source("figure/figure_main_generator/library_path.R")
data2 = read.delim("data/data2_supp.tab")
dt_graph = data2[data2$species == "Homo_sapiens" ,]
# Pannel 9 A
pA = ggplot(dt_graph , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=80,size=0.2)+ theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=25, family="economica"),
axis.text.x =  element_text(color="black", size=25, family="economica"),
title =  element_text(color="black", size=16, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab("GC3 rate per gene") + ylab("Number of genes") + ggtitle(paste("All genes, N=",format(nrow(dt_graph),big.mark=",",scientific=T))) + xlim(0,1)
pA
jpeg(paste(path_pannel,"p9A.jpg",sep=""),
width = 6000/4.5,  5000/4,res=1000/4)
print(pA)
dev.off()
# Pannel 9 B
# Load data on gene features + meiotic expression from Pouyet et al. 2017
D=read.table(file="data/human_genes_summary", header = TRUE)
# Load data on somatic expression from Pouyet et al. 2017
EF=read.table(file="data/human_genes_expression_in_tissues", header = TRUE)
merge_dt = merge.data.frame(x=D,y=EF,by="Ensembl.Gene.ID")
top_quantile = 0.8
ltissue = names(merge_dt)[39:65]
merge_dt$NbTissueTopExp = 0
for(tissue in ltissue) {
qX=quantile(merge_dt[,tissue], probs = top_quantile, na.rm=TRUE)
lsel=which(merge_dt[,tissue]>qX)
merge_dt$NbTissueTopExp[lsel]=merge_dt$NbTissueTopExp[lsel]+1
}
dt_graph=merge_dt[which(merge_dt$NbTissueTopExp>20),]
# pB = ggplot(dt_graph[dt_graph$gene_expression >= quantile(dt_graph$gene_expression,0.80),] , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50)+ theme_bw() + theme(
pB = ggplot(dt_graph , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50,size=0.2)+ theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=25, family="economica"),
axis.text.x =  element_text(color="black", size=25, family="economica"),
title =  element_text(color="black", size=16, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab("GC3 rate per gene") + ylab("Number of genes") +
ggtitle(paste("N=",format(nrow(dt_graph),big.mark=",",scientific=T),"housekeeping genes")) +
xlim(0,1)
pB
jpeg(paste(path_pannel,"p9B.jpg",sep=""),
width = 6000/4.5,  5000/4,res=1000/4)
print(pB)
dev.off()
# Pannel 9 C
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1[,c("lifespan_days","length_cm","weight_kg")] = GTDrift_list_species[data1$species,c("lifespan_days","length_cm","weight_kg")]
dnds = read.delim("data/GTDrift_Metazoa_dNdS.tab")
rownames(dnds) = dnds$species
data1[,c("dNdS")] = dnds[data1$species,c("dNdS")]
dt_graph = data1
ylabel = "S_POCs"
xlabel = "var_gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=T,pagels_obliged=F)
pC =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
=======
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(labels=label_log(digits = 2)) + xlab("Body Weight (kg, log scale)")+ annotation_logticks(sides="b") +
guides(fill = "none",
shape = guide_legend(byrow = TRUE,override.aes = list(fill="black")))
pC
jpeg(paste(path_pannel,"p7C.jpg",sep=""),width = 4200/2, height = 4000/2,res=700/2)
print(pC)
dev.off()
# Pannel 7 D
dt_graph = data1
ylabel = "S_POCs"
xlabel = "dNdS"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pD = ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
>>>>>>> 35e0bdda9a8838872cf977dc0b1c94970070c93a
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
<<<<<<< HEAD
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 1)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=25, family="economica")
)+ guides(fill = guide_legend(override.aes = list(size=5)))+
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
xlab("Variance per gene GCi")
pC
jpeg(paste(path_pannel,"p9C.jpg",sep=""),width = 6000/2, height = 3550/2,res=700/2)
print(pC)
dev.off()
# Pannel 9 D
dt_graph = data1
ylabel = "S_POCs"
xlabel = "var_gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label ,]
dt_graph = dt_graph[!is.na(dt_graph$lifespan_days),]
dt_graph = dt_graph[order(dt_graph$lifespan_days,decreasing = T),]
pD =  ggplot(dt_graph,aes_string(y=ylabel , x=xlabel))  +
geom_point(size=4,pch=21,alpha=1,aes(fill=log10(lifespan_days))) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=15, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=23, family="economica")
)+ ylab("Population-scaled selection coefficient (S)") +
xlab("Variance per gene GCi") +
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_gradient2('Longevity\n(days, log scale)',mid = "white",  high = "red")
pD
jpeg(paste(path_pannel,"p9D.jpg",sep=""),width = 5800/2, height = 3550/2,res=700/2)
print(pD)
dev.off()
# Pannel 9 E
dt_graph = data1
ylabel = "S_POCs"
xlabel = "lifespan_days"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=T,pagels_obliged=F)
pE =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 1)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=25, family="economica")
)+ guides(fill = guide_legend(override.aes = list(size=5)))+
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,100,1000,10000),labels=c(0.05,0.1,0.5,1,5,10,100,1000,10000)) +
xlab("Longevity (days, log scale)")+ annotation_logticks(sides="b")
pE
jpeg(paste(path_pannel,"p9E.jpg",sep=""),width = 6000/2, height = 3550/2,res=700/2)
print(pE)
dev.off()
# Pannel 9 F
dt_graph = data1
ylabel = "S_POCs"
xlabel = "lifespan_days"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
dt_graph = dt_graph[dt_graph$var_gci<0.015,]
dt_graph = dt_graph[order(dt_graph$var_gci,decreasing = T),]
pF =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_point(size=4,pch=21,alpha=1,aes(fill=var_gci)) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=15, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=23, family="economica")
)+ ylab("Population-scaled selection coefficient (S)") +
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_gradient2('Variance\nper gene GCi',mid = "white",  high = "red") +
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,100,1000,10000),labels=c(0.05,0.1,0.5,1,5,10,100,1000,10000)) +
xlab("Longevity (days, log scale)")+ annotation_logticks(sides="b")
pF
jpeg(paste(path_pannel,"p9F.jpg",sep=""),width = 5500/2, height = 3550/2,res=700/2)
print(pF)
dev.off()
# Figure 9
imgA = load.image(paste(path_pannel,"p9A.jpg",sep="") )
imgB = load.image(paste(path_pannel,"p9B.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p9C.jpg",sep="") )
imgD = load.image(paste(path_pannel,"p9D.jpg",sep="") )
imgE = load.image(paste(path_pannel,"p9E.jpg",sep="") )
imgF = load.image(paste(path_pannel,"p9F.jpg",sep="") )
{
pdf(file= paste(path_figure,"Figure9.pdf",sep=""), width=11, height=8*3/2)
m = matrix(rep(NA,3*100), nrow=3)
m[1,]=c(rep(1,50),rep(2,50))
m[2,]=c(rep(3,51),rep(4,49))
m[3,]=c(rep(5,51),rep(6,49))
layout(m)
par(mar=c(0,0, 1, 0))
plot(imgA, axes=FALSE)
mtext("A",at=100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
plot(imgB, axes=FALSE)
mtext("B",at=100,adj=0, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 1))
plot(imgC, axes=FALSE)
mtext("C",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 1))
plot(imgD, axes=FALSE)
mtext("D",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 1))
plot(imgE, axes=FALSE)
mtext("E",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 2))
plot(imgF, axes=FALSE)
mtext("F",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
dev.off()
}
# Generate Figure 9
source("figure/figure_main_generator/library_path.R")
data2 = read.delim("data/data2_supp.tab")
dt_graph = data2[data2$species == "Homo_sapiens" ,]
# Pannel 9 A
pA = ggplot(dt_graph , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=80,size=0.2)+ theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=25, family="economica"),
axis.text.x =  element_text(color="black", size=25, family="economica"),
title =  element_text(color="black", size=16, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab("GC3 rate per gene") + ylab("Number of genes") + ggtitle(paste("All genes, N=",format(nrow(dt_graph),big.mark=",",scientific=T))) + xlim(0,1)
pA
jpeg(paste(path_pannel,"p9A.jpg",sep=""),
width = 6000/4.5,  5000/4,res=1000/4)
print(pA)
dev.off()
# Pannel 9 B
# Load data on gene features + meiotic expression from Pouyet et al. 2017
D=read.table(file="data/human_genes_summary", header = TRUE)
# Load data on somatic expression from Pouyet et al. 2017
EF=read.table(file="data/human_genes_expression_in_tissues", header = TRUE)
merge_dt = merge.data.frame(x=D,y=EF,by="Ensembl.Gene.ID")
top_quantile = 0.8
ltissue = names(merge_dt)[39:65]
merge_dt$NbTissueTopExp = 0
for(tissue in ltissue) {
qX=quantile(merge_dt[,tissue], probs = top_quantile, na.rm=TRUE)
lsel=which(merge_dt[,tissue]>qX)
merge_dt$NbTissueTopExp[lsel]=merge_dt$NbTissueTopExp[lsel]+1
}
dt_graph=merge_dt[which(merge_dt$NbTissueTopExp>20),]
# pB = ggplot(dt_graph[dt_graph$gene_expression >= quantile(dt_graph$gene_expression,0.80),] , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50)+ theme_bw() + theme(
pB = ggplot(dt_graph , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50,size=0.2)+ theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=25, family="economica"),
axis.text.x =  element_text(color="black", size=25, family="economica"),
title =  element_text(color="black", size=16, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab("GC3 rate per gene") + ylab("Number of genes") +
ggtitle(paste(format(nrow(dt_graph),big.mark=",",scientific=T),"housekeeping genes")) +
xlim(0,1)
pB
jpeg(paste(path_pannel,"p9B.jpg",sep=""),
width = 6000/4.5,  5000/4,res=1000/4)
print(pB)
dev.off()
# Pannel 9 C
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1[,c("lifespan_days","length_cm","weight_kg")] = GTDrift_list_species[data1$species,c("lifespan_days","length_cm","weight_kg")]
dnds = read.delim("data/GTDrift_Metazoa_dNdS.tab")
rownames(dnds) = dnds$species
data1[,c("dNdS")] = dnds[data1$species,c("dNdS")]
dt_graph = data1
ylabel = "S_POCs"
xlabel = "var_gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=T,pagels_obliged=F)
pC =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
=======
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.6, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_manual(values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") + xlab("dN/dS (log scale)") + scale_x_log10()+ annotation_logticks(sides="b")
pD
jpeg(paste(path_pannel,"p7D.jpg",sep=""),width = 4200/2, height = 4000/2,res=700/2)
print(pD)
dev.off()
# Supplementary Figure 10
imgA = load.image(paste(path_pannel,"p7A.jpg",sep="") )
imgB = load.image(paste(path_pannel,"p7B.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p7C.jpg",sep="") )
imgD = load.image(paste(path_pannel,"p7D.jpg",sep="") )
{
pdf(file= paste(path_figure,"Figure7.pdf",sep=""), width=10, height=8)
m = matrix(rep(NA,2*100), nrow=2)
m[1,]=c(rep(1,60),rep(2,40))
m[2,]=c(rep(3,50),rep(4,50))
layout(m)
par(mar=c(0,0, 2, 0))
plot(imgA, axes=FALSE)
mtext("A",at=0,adj=-1, side=2, line=1, font=2, cex=2,las=2)
plot(imgB, axes=FALSE)
mtext("B",at=0,adj=0, side=2, line=1, font=2, cex=2,las=2)
plot(imgC, axes=FALSE)
mtext("C",at=0,adj=-1, side=2, line=1, font=2, cex=2,las=2)
plot(imgD, axes=FALSE)
mtext("D",at=0,adj=-1, side=2, line=1, font=2, cex=2,las=2)
dev.off()
}
# Generate Figure 7
source("figure/figure_main_generator/library_path.R")
resolution=2
lynch_dt = read.table("data/Lynch2023_embr202357561-sup-0002-metazoa.csv",header=T,sep="\t",dec=",")
lynch_dt$species = str_replace_all(lynch_dt$Species," ","_")
lynch_dt$species = sapply(lynch_dt$species ,function(x) paste(str_split_1(x,"_")[1],str_split_1(x,"_")[2],sep="_"))
lynch_dt$genus = sapply(lynch_dt$species ,function(x) str_split_1(x,"_")[1])
rownames(lynch_dt) = lynch_dt$species
lynch_dt$mass = as.numeric(lynch_dt$Dry.Mass.at.Maturity...µg.)/1e9
Ne_genus = tapply(lynch_dt$Ne,lynch_dt$genus,mean)
mass_genus = tapply(lynch_dt$mass,lynch_dt$genus,function(x) mean(x,na.rm=T))
data1 = read.delim("data/data1_supp.tab")
data1$Ne = lynch_dt[data1$species,]$Ne
data1$Ne_estimate = "from genus"
data1[!is.na(data1$Ne),]$Ne_estimate = "from species"
data1[is.na(data1$Ne),]$Ne = Ne_genus[sapply(data1[is.na(data1$Ne),]$species ,function(x) str_split_1(x,"_")[1])]
data1[is.na(data1$Ne),]$Ne_estimate = ""
data1$Mass_Lynch = lynch_dt[data1$species,]$mass
data1$Mass_Lynch_estimate = "from genus"
data1[!is.na(data1$Mass_Lynch),]$Mass_Lynch_estimate = "from species"
data1[is.na(data1$Mass_Lynch),]$Mass_Lynch = mass_genus[sapply(data1[is.na(data1$Mass_Lynch),]$species ,function(x) str_split_1(x,"_")[1])]
data1[is.na(data1$Mass_Lynch),]$Mass_Lynch_estimate = ""
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1[,c("lifespan_days","length_cm","weight_kg")] = GTDrift_list_species[data1$species,c("lifespan_days","length_cm","weight_kg")]
dnds = read.delim("data/GTDrift_Metazoa_dNdS.tab")
rownames(dnds) = dnds$species
data1[,c("dNdS")] = dnds[data1$species,c("dNdS")]
# Pannel 7 A
dt_graph = data1
ylabel = "S_POCs"
xlabel = "lifespan_days"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pA =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=5,pch=21,alpha=0.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=28,family="economica"),
axis.title.y = element_text(color="black", size=28, family="economica"),
axis.text.y =  element_text(color="black", size=26, family="economica"),
axis.text.x =  element_text(color="black", size=26, family="economica"),
title =  element_text(color="black", size=25, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.35, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,100,1000,10000),labels=c(0.05,0.1,0.5,1,5,10,100,1000,10000)) +
xlab("Longevity (days, log scale)")+ annotation_logticks(sides="b")
pA
jpeg(paste(path_pannel,"p7A.jpg",sep=""), width = 9000/resolution, height = 6000/resolution,res=900/resolution)
print(pA)
dev.off()
# Pannel 7 B
dt_graph = data1
ylabel = "S_POCs"
xlabel = "length_cm"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pB = ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
# geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.6, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_manual(values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(breaks=c(0.01,0.1,1,10,100,1000,5000),labels=c(0.01,0.1,1,10,100,1000,5000)) + xlab("Body length (cm, log scale)")+ annotation_logticks(sides="b")
pB
jpeg(paste(path_pannel,"p7B.jpg",sep=""),width = 4200/2, height = 4000/2,res=700/2)
print(pB)
dev.off()
# Pannel 7 C
dt_graph = data1
ylabel = "S_POCs"
xlabel = "Ne"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pC =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel,shape="Ne_estimate"))  + scale_shape_manual(expression(paste(italic("N"[e])," estimates")),values=c(24,21)) +
# geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=4,alpha=.8) + theme_bw() + theme(
>>>>>>> 35e0bdda9a8838872cf977dc0b1c94970070c93a
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
<<<<<<< HEAD
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 1)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=25, family="economica")
)+ guides(fill = guide_legend(override.aes = list(size=5)))+
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
xlab("Variance per gene GCi")
pC
jpeg(paste(path_pannel,"p9C.jpg",sep=""),width = 6000/2, height = 3550/2,res=700/2)
print(pC)
dev.off()
# Pannel 9 D
dt_graph = data1
ylabel = "S_POCs"
xlabel = "var_gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label ,]
dt_graph = dt_graph[!is.na(dt_graph$lifespan_days),]
dt_graph = dt_graph[order(dt_graph$lifespan_days,decreasing = T),]
pD =  ggplot(dt_graph,aes_string(y=ylabel , x=xlabel))  +
geom_point(size=4,pch=21,alpha=1,aes(fill=log10(lifespan_days))) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=15, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=23, family="economica")
)+ ylab("Population-scaled selection coefficient (S)") +
xlab("Variance per gene GCi") +
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_gradient2('Longevity\n(days, log scale)',mid = "white",  high = "red")
pD
jpeg(paste(path_pannel,"p9D.jpg",sep=""),width = 5800/2, height = 3550/2,res=700/2)
print(pD)
dev.off()
# Pannel 9 E
dt_graph = data1
ylabel = "S_POCs"
xlabel = "lifespan_days"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=T,pagels_obliged=F)
pE =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
=======
legend.text =  element_text(color="black", size=15, family="economica",vjust = 1.5 , margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.5, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(labels=label_log(digits = 2)) + xlab("Body Weight (kg, log scale)")+ annotation_logticks(sides="b") +
guides(fill = "none",
shape = guide_legend(byrow = TRUE,override.aes = list(fill="black")))
pC
jpeg(paste(path_pannel,"p7C.jpg",sep=""),width = 4200/2, height = 4000/2,res=700/2)
print(pC)
dev.off()
# Pannel 7 D
dt_graph = data1
ylabel = "S_POCs"
xlabel = "dNdS"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pD = ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
>>>>>>> 35e0bdda9a8838872cf977dc0b1c94970070c93a
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
<<<<<<< HEAD
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 1)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=25, family="economica")
)+ guides(fill = guide_legend(override.aes = list(size=5)))+
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,100,1000,10000),labels=c(0.05,0.1,0.5,1,5,10,100,1000,10000)) +
xlab("Longevity (days, log scale)")+ annotation_logticks(sides="b")
pE
jpeg(paste(path_pannel,"p9E.jpg",sep=""),width = 6000/2, height = 3550/2,res=700/2)
print(pE)
dev.off()
# Pannel 9 F
dt_graph = data1
ylabel = "S_POCs"
xlabel = "lifespan_days"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
dt_graph = dt_graph[dt_graph$var_gci<0.015,]
dt_graph = dt_graph[order(dt_graph$var_gci,decreasing = T),]
pF =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_point(size=4,pch=21,alpha=1,aes(fill=var_gci)) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=15, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=23, family="economica")
)+ ylab("Population-scaled selection coefficient (S)") +
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_gradient2('Variance\nper gene GCi',mid = "white",  high = "red") +
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,100,1000,10000),labels=c(0.05,0.1,0.5,1,5,10,100,1000,10000)) +
xlab("Longevity (days, log scale)")+ annotation_logticks(sides="b")
pF
jpeg(paste(path_pannel,"p9F.jpg",sep=""),width = 5500/2, height = 3550/2,res=700/2)
print(pF)
dev.off()
# Figure 9
imgA = load.image(paste(path_pannel,"p9A.jpg",sep="") )
imgB = load.image(paste(path_pannel,"p9B.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p9C.jpg",sep="") )
imgD = load.image(paste(path_pannel,"p9D.jpg",sep="") )
imgE = load.image(paste(path_pannel,"p9E.jpg",sep="") )
imgF = load.image(paste(path_pannel,"p9F.jpg",sep="") )
{
pdf(file= paste(path_figure,"Figure9.pdf",sep=""), width=11, height=8*3/2)
m = matrix(rep(NA,3*100), nrow=3)
m[1,]=c(rep(1,50),rep(2,50))
m[2,]=c(rep(3,51),rep(4,49))
m[3,]=c(rep(5,51),rep(6,49))
layout(m)
par(mar=c(0,0, 1, 0))
plot(imgA, axes=FALSE)
mtext("A",at=100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
plot(imgB, axes=FALSE)
mtext("B",at=100,adj=0, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 1))
plot(imgC, axes=FALSE)
mtext("C",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 1))
plot(imgD, axes=FALSE)
mtext("D",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 1))
plot(imgE, axes=FALSE)
mtext("E",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 2))
plot(imgF, axes=FALSE)
mtext("F",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
=======
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.6, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_manual(values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") + xlab("dN/dS (log scale)") + scale_x_log10()+ annotation_logticks(sides="b")
pD
jpeg(paste(path_pannel,"p7D.jpg",sep=""),width = 4200/2, height = 4000/2,res=700/2)
print(pD)
dev.off()
# Supplementary Figure 10
imgA = load.image(paste(path_pannel,"p7A.jpg",sep="") )
imgB = load.image(paste(path_pannel,"p7B.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p7C.jpg",sep="") )
imgD = load.image(paste(path_pannel,"p7D.jpg",sep="") )
{
pdf(file= paste(path_figure,"Figure7.pdf",sep=""), width=10, height=8)
m = matrix(rep(NA,2*100), nrow=2)
m[1,]=c(rep(1,60),rep(2,40))
m[2,]=c(rep(3,50),rep(4,50))
layout(m)
par(mar=c(0,0, 2, 0))
plot(imgA, axes=FALSE)
mtext("A",at=0,adj=-1, side=2, line=1, font=2, cex=2,las=2)
plot(imgB, axes=FALSE)
mtext("B",at=0,adj=0, side=2, line=1, font=2, cex=2,las=2)
plot(imgC, axes=FALSE)
mtext("C",at=0,adj=-1, side=2, line=1, font=2, cex=2,las=2)
plot(imgD, axes=FALSE)
mtext("D",at=0,adj=-1, side=2, line=1, font=2, cex=2,las=2)
dev.off()
}
# Generate Figure 7
source("figure/figure_main_generator/library_path.R")
resolution=2
lynch_dt = read.table("data/Lynch2023_embr202357561-sup-0002-metazoa.csv",header=T,sep="\t",dec=",")
lynch_dt$species = str_replace_all(lynch_dt$Species," ","_")
lynch_dt$species = sapply(lynch_dt$species ,function(x) paste(str_split_1(x,"_")[1],str_split_1(x,"_")[2],sep="_"))
lynch_dt$genus = sapply(lynch_dt$species ,function(x) str_split_1(x,"_")[1])
rownames(lynch_dt) = lynch_dt$species
lynch_dt$mass = as.numeric(lynch_dt$Dry.Mass.at.Maturity...µg.)/1e9
Ne_genus = tapply(lynch_dt$Ne,lynch_dt$genus,mean)
mass_genus = tapply(lynch_dt$mass,lynch_dt$genus,function(x) mean(x,na.rm=T))
data1 = read.delim("data/data1_supp.tab")
data1$Ne = lynch_dt[data1$species,]$Ne
data1$Ne_estimate = "from genus"
data1[!is.na(data1$Ne),]$Ne_estimate = "from species"
data1[is.na(data1$Ne),]$Ne = Ne_genus[sapply(data1[is.na(data1$Ne),]$species ,function(x) str_split_1(x,"_")[1])]
data1[is.na(data1$Ne),]$Ne_estimate = ""
data1$Mass_Lynch = lynch_dt[data1$species,]$mass
data1$Mass_Lynch_estimate = "from genus"
data1[!is.na(data1$Mass_Lynch),]$Mass_Lynch_estimate = "from species"
data1[is.na(data1$Mass_Lynch),]$Mass_Lynch = mass_genus[sapply(data1[is.na(data1$Mass_Lynch),]$species ,function(x) str_split_1(x,"_")[1])]
data1[is.na(data1$Mass_Lynch),]$Mass_Lynch_estimate = ""
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1[,c("lifespan_days","length_cm","weight_kg")] = GTDrift_list_species[data1$species,c("lifespan_days","length_cm","weight_kg")]
dnds = read.delim("data/GTDrift_Metazoa_dNdS.tab")
rownames(dnds) = dnds$species
data1[,c("dNdS")] = dnds[data1$species,c("dNdS")]
# Pannel 7 A
dt_graph = data1
ylabel = "S_POCs"
xlabel = "lifespan_days"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pA =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=5,pch=21,alpha=0.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=28,family="economica"),
axis.title.y = element_text(color="black", size=28, family="economica"),
axis.text.y =  element_text(color="black", size=26, family="economica"),
axis.text.x =  element_text(color="black", size=26, family="economica"),
title =  element_text(color="black", size=25, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.35, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,100,1000,10000),labels=c(0.05,0.1,0.5,1,5,10,100,1000,10000)) +
xlab("Longevity (days, log scale)")+ annotation_logticks(sides="b")
pA
jpeg(paste(path_pannel,"p7A.jpg",sep=""), width = 9000/resolution, height = 6000/resolution,res=900/resolution)
print(pA)
dev.off()
# Pannel 7 B
dt_graph = data1
ylabel = "S_POCs"
xlabel = "length_cm"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pB = ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
# geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.6, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_manual(values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(breaks=c(0.01,0.1,1,10,100,1000,5000),labels=c(0.01,0.1,1,10,100,1000,5000)) + xlab("Body length (cm, log scale)")+ annotation_logticks(sides="b")
pB
jpeg(paste(path_pannel,"p7B.jpg",sep=""),width = 4200/2, height = 4000/2,res=700/2)
print(pB)
dev.off()
# Pannel 7 C
dt_graph = data1
ylabel = "S_POCs"
xlabel = "Ne"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pC =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel,shape="Ne_estimate"))  + scale_shape_manual(expression(paste(italic("N"[e])," estimates")),values=c(24,21)) +
# geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=4,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=15, family="economica",vjust = 1.5 , margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.5, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(labels=label_log(digits = 2)) + xlab("Body Weight (kg, log scale)")+ annotation_logticks(sides="b") +
guides(fill = "none",
shape = guide_legend(byrow = TRUE,override.aes = list(fill="black")))
pC
jpeg(paste(path_pannel,"p7C.jpg",sep=""),width = 5200/2, height = 4000/2,res=700/2)
print(pC)
dev.off()
# Generate Figure 7
source("figure/figure_main_generator/library_path.R")
resolution=2
lynch_dt = read.table("data/Lynch2023_embr202357561-sup-0002-metazoa.csv",header=T,sep="\t",dec=",")
lynch_dt$species = str_replace_all(lynch_dt$Species," ","_")
lynch_dt$species = sapply(lynch_dt$species ,function(x) paste(str_split_1(x,"_")[1],str_split_1(x,"_")[2],sep="_"))
lynch_dt$genus = sapply(lynch_dt$species ,function(x) str_split_1(x,"_")[1])
rownames(lynch_dt) = lynch_dt$species
lynch_dt$mass = as.numeric(lynch_dt$Dry.Mass.at.Maturity...µg.)/1e9
Ne_genus = tapply(lynch_dt$Ne,lynch_dt$genus,mean)
mass_genus = tapply(lynch_dt$mass,lynch_dt$genus,function(x) mean(x,na.rm=T))
data1 = read.delim("data/data1_supp.tab")
data1$Ne = lynch_dt[data1$species,]$Ne
data1$Ne_estimate = "from genus"
data1[!is.na(data1$Ne),]$Ne_estimate = "from species"
data1[is.na(data1$Ne),]$Ne = Ne_genus[sapply(data1[is.na(data1$Ne),]$species ,function(x) str_split_1(x,"_")[1])]
data1[is.na(data1$Ne),]$Ne_estimate = ""
data1$Mass_Lynch = lynch_dt[data1$species,]$mass
data1$Mass_Lynch_estimate = "from genus"
data1[!is.na(data1$Mass_Lynch),]$Mass_Lynch_estimate = "from species"
data1[is.na(data1$Mass_Lynch),]$Mass_Lynch = mass_genus[sapply(data1[is.na(data1$Mass_Lynch),]$species ,function(x) str_split_1(x,"_")[1])]
data1[is.na(data1$Mass_Lynch),]$Mass_Lynch_estimate = ""
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1[,c("lifespan_days","length_cm","weight_kg")] = GTDrift_list_species[data1$species,c("lifespan_days","length_cm","weight_kg")]
dnds = read.delim("data/GTDrift_Metazoa_dNdS.tab")
rownames(dnds) = dnds$species
data1[,c("dNdS")] = dnds[data1$species,c("dNdS")]
# Pannel 7 A
dt_graph = data1
ylabel = "S_POCs"
xlabel = "lifespan_days"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pA =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=5,pch=21,alpha=0.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=28,family="economica"),
axis.title.y = element_text(color="black", size=28, family="economica"),
axis.text.y =  element_text(color="black", size=26, family="economica"),
axis.text.x =  element_text(color="black", size=26, family="economica"),
title =  element_text(color="black", size=25, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.35, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,100,1000,10000),labels=c(0.05,0.1,0.5,1,5,10,100,1000,10000)) +
xlab("Longevity (days, log scale)")+ annotation_logticks(sides="b")
pA
jpeg(paste(path_pannel,"p7A.jpg",sep=""), width = 9000/resolution, height = 6000/resolution,res=900/resolution)
print(pA)
dev.off()
# Pannel 7 B
dt_graph = data1
ylabel = "S_POCs"
xlabel = "length_cm"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pB = ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
# geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.6, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_manual(values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(breaks=c(0.01,0.1,1,10,100,1000,5000),labels=c(0.01,0.1,1,10,100,1000,5000)) + xlab("Body length (cm, log scale)")+ annotation_logticks(sides="b")
pB
jpeg(paste(path_pannel,"p7B.jpg",sep=""),width = 4200/2, height = 4000/2,res=700/2)
print(pB)
dev.off()
# Pannel 7 C
dt_graph = data1
ylabel = "S_POCs"
xlabel = "Ne"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pC =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel,shape="Ne_estimate"))  + scale_shape_manual(expression(paste(italic("N"[e])," estimates")),values=c(24,21)) +
# geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=4,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=15, family="economica",vjust = 1.5 , margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.5, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(labels=label_log(digits = 2)) + xlab("Body Weight (kg, log scale)")+ annotation_logticks(sides="b") +
guides(fill = "none",
shape = guide_legend(byrow = TRUE,override.aes = list(fill="black")))
pC
jpeg(paste(path_pannel,"p7C.jpg",sep=""),width = 5000/2, height = 4000/2,res=700/2)
print(pC)
dev.off()
# Pannel 7 D
dt_graph = data1
ylabel = "S_POCs"
xlabel = "dNdS"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pD = ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.6, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste(model,lambda," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_manual(values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") + xlab("dN/dS (log scale)") + scale_x_log10()+ annotation_logticks(sides="b")
pD
jpeg(paste(path_pannel,"p7D.jpg",sep=""),width = 4200/2, height = 4000/2,res=700/2)
print(pD)
dev.off()
# Supplementary Figure 10
imgA = load.image(paste(path_pannel,"p7A.jpg",sep="") )
imgB = load.image(paste(path_pannel,"p7B.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p7C.jpg",sep="") )
imgD = load.image(paste(path_pannel,"p7D.jpg",sep="") )
{
pdf(file= paste(path_figure,"Figure7.pdf",sep=""), width=10, height=8)
m = matrix(rep(NA,2*100), nrow=2)
m[1,]=c(rep(1,60),rep(2,40))
m[2,]=c(rep(3,50),rep(4,50))
layout(m)
par(mar=c(0,0, 2, 0))
plot(imgA, axes=FALSE)
mtext("A",at=0,adj=-1, side=2, line=1, font=2, cex=2,las=2)
plot(imgB, axes=FALSE)
mtext("B",at=0,adj=0, side=2, line=1, font=2, cex=2,las=2)
plot(imgC, axes=FALSE)
mtext("C",at=0,adj=-1, side=2, line=1, font=2, cex=2,las=2)
plot(imgD, axes=FALSE)
mtext("D",at=0,adj=-1, side=2, line=1, font=2, cex=2,las=2)
>>>>>>> 35e0bdda9a8838872cf977dc0b1c94970070c93a
dev.off()
}
