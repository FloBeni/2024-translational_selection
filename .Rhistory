strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab("GC3 rate per gene") + ylab("Number of genes") + ggtitle("All genes") + xlim(0,1)
pA
jpeg(paste(path_pannel,"p9A.jpg",sep=""),
width = 6000/4.5,  5000/4,res=1000/4)
print(pA)
dev.off()
# Pannel 9 B
# Load data on gene features + meiotic expression from Pouyet et al. 2017
D=read.table(file="data/human_genes_summary", header = TRUE)
# Load data on somatic expression from Pouyet et al. 2017
EF=read.table(file="data/human_genes_expression_in_tissues", header = TRUE)
merge_dt = merge.data.frame(x=D,y=EF,by="Ensembl.Gene.ID")
top_quantile = 0.8
ltissue = names(merge_dt)[39:65]
merge_dt$NbTissueTopExp = 0
for(tissue in ltissue) {
qX=quantile(merge_dt[,tissue], probs = top_quantile, na.rm=TRUE)
lsel=which(merge_dt[,tissue]>qX)
merge_dt$NbTissueTopExp[lsel]=merge_dt$NbTissueTopExp[lsel]+1
}
dt_graph=merge_dt[which(merge_dt$NbTissueTopExp>20),]
# pB = ggplot(dt_graph[dt_graph$gene_expression >= quantile(dt_graph$gene_expression,0.80),] , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50)+ theme_bw() + theme(
pB = ggplot(dt_graph , aes(x=GC3))  + geom_histogram(fill="#FF7F00",col="black",bins=50,size=0.2)+ theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=30, family="economica"),
axis.text.y =  element_text(color="black", size=25, family="economica"),
axis.text.x =  element_text(color="black", size=25, family="economica"),
title =  element_text(color="black", size=16, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab("GC3 rate per gene") + ylab("Number of genes") + ggtitle(paste(nrow(dt_graph),"housekeeping genes") ) + xlim(0,1)
pB
jpeg(paste(path_pannel,"p9B.jpg",sep=""),
width = 6000/4.5,  5000/4,res=1000/4)
print(pB)
dev.off()
# Pannel 9 C
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
data1[,c("lifespan_days","length_cm","weight_kg")] = GTDrift_list_species[data1$species,c("lifespan_days","length_cm","weight_kg")]
dnds = read.delim("data/GTDrift_Metazoa_dNdS.tab")
rownames(dnds) = dnds$species
data1[,c("dNdS")] = dnds[data1$species,c("dNdS")]
dt_graph = data1
ylabel = "S_POCs"
xlabel = "var_gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=T,pagels_obliged=F)
pC =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 1)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=25, family="economica")
)+ guides(fill = guide_legend(override.aes = list(size=5)))+
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
xlab("Variance per gene GCi")
pC
jpeg(paste(path_pannel,"p9C.jpg",sep=""),width = 6000/2, height = 3550/2,res=700/2)
print(pC)
dev.off()
# Pannel 9 D
dt_graph = data1
ylabel = "S_POCs"
xlabel = "var_gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label ,]
dt_graph = dt_graph[!is.na(dt_graph$lifespan_days),]
dt_graph = dt_graph[order(dt_graph$lifespan_days,decreasing = T),]
pD =  ggplot(dt_graph,aes_string(y=ylabel , x=xlabel))  +
geom_point(size=4,pch=21,alpha=1,aes(fill=log10(lifespan_days))) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=15, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=23, family="economica")
)+ ylab("Population-scaled selection coefficient (S)") +
xlab("Variance per gene GCi") +
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + scale_fill_gradient2('Longevity\n(days, log scale)',mid = "white",  high = "red")
pD
jpeg(paste(path_pannel,"p9D.jpg",sep=""),width = 5800/2, height = 3550/2,res=700/2)
print(pD)
dev.off()
# Pannel 9 E
dt_graph = data1
ylabel = "S_POCs"
xlabel = "lifespan_days"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=log10(dt_graph[,xlabel]),y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=T,pagels_obliged=F)
pE =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 1)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=25, family="economica")
)+ guides(fill = guide_legend(override.aes = list(size=5)))+
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_manual("Clades",values=Clade_color) +
ylab("Population-scaled selection coefficient (S)") +
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,100,1000,10000),labels=c(0.05,0.1,0.5,1,5,10,100,1000,10000)) +
xlab("Longevity (days, log scale)")+ annotation_logticks(sides="b")
pE
jpeg(paste(path_pannel,"p9E.jpg",sep=""),width = 6000/2, height = 3550/2,res=700/2)
print(pE)
dev.off()
# Pannel 9 F
dt_graph = data1
ylabel = "S_POCs"
xlabel = "lifespan_days"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
dt_graph = dt_graph[dt_graph$var_gci<0.015,]
dt_graph = dt_graph[order(dt_graph$var_gci,decreasing = T),]
pF =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_point(size=4,pch=21,alpha=1,aes(fill=var_gci)) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=24, family="economica"),
axis.text.x =  element_text(color="black", size=24, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=15, family="economica"),
plot.caption.position =  "plot",
legend.title =  element_text(color="black", size=23, family="economica")
)+ ylab("Population-scaled selection coefficient (S)") +
labs(
title = paste("N = ",nrow(dt_graph)," species",sep="")
)+ scale_fill_gradient2('Variance\nper gene GCi',mid = "white",  high = "red") +
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,100,1000,10000),labels=c(0.05,0.1,0.5,1,5,10,100,1000,10000)) +
xlab("Longevity (days, log scale)")+ annotation_logticks(sides="b")
pF
jpeg(paste(path_pannel,"p9F.jpg",sep=""),width = 5500/2, height = 3550/2,res=700/2)
print(pF)
dev.off()
# Figure 9
imgA = load.image(paste(path_pannel,"p9A.jpg",sep="") )
imgB = load.image(paste(path_pannel,"p9B.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p9C.jpg",sep="") )
imgD = load.image(paste(path_pannel,"p9D.jpg",sep="") )
imgE = load.image(paste(path_pannel,"p9E.jpg",sep="") )
imgF = load.image(paste(path_pannel,"p9F.jpg",sep="") )
{
pdf(file= paste(path_figure,"Figure9.pdf",sep=""), width=11, height=8*3/2)
m = matrix(rep(NA,3*100), nrow=3)
m[1,]=c(rep(1,50),rep(2,50))
m[2,]=c(rep(3,51),rep(4,49))
m[3,]=c(rep(5,51),rep(6,49))
layout(m)
par(mar=c(0,0, 1, 0))
plot(imgA, axes=FALSE)
mtext("A",at=100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
plot(imgB, axes=FALSE)
mtext("B",at=100,adj=0, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 1))
plot(imgC, axes=FALSE)
mtext("C",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 1))
plot(imgD, axes=FALSE)
mtext("D",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 1))
plot(imgE, axes=FALSE)
mtext("E",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
par(mar=c(0,0, 0, 2))
plot(imgF, axes=FALSE)
mtext("F",at=-100,adj=-1, side=2, line=1, font=2, cex=2,las=2)
dev.off()
}
source("figure/figure_main_generator/library_path.R")
data1 = read.delim("data/data1_supp.tab")
rownames(data1) = data1$species
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
##  Abstract
print("Abstract")
##  Introduction
print("Introduction")
##  Non-adaptive processes shape codon usage variations across species
print("Non-adaptive processes are the primary drivers of codon usage variations among metazoans")
##  Non-adaptive processes shape codon usage variations across species
print("Non-adaptive processes are the primary drivers of codon usage variations among metazoans")
print(paste("position between ",nrow(data1[ data1$nb_genes_filtered >= 5000,])," metazoan species",sep=""))
data1 = read.delim("data/data1_supp.tab")
rownames(data1) = data1$species
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
##  Abstract
print("Abstract")
##  Introduction
print("Introduction")
##  Non-adaptive processes shape codon usage variations across species
print("Non-adaptive processes are the primary drivers of codon usage variations among metazoans")
print(paste("position between ",nrow(data1[ data1$nb_genes_filtered >= 5000,])," metazoan species",sep=""))
print(paste("position between ",nrow(data1)," metazoan species",sep=""))
print(paste("after removal of species lacking gene expression data (N=",nrow(data1[ data1$nb_genes_filtered < 5000,]),")",sep=""))
print(paste("after removal of species lacking gene expression data (N=",nrow(data1[ data1$nb_genes_filtered < 5000,]),"",sep=""))
print(paste("after removal of species lacking gene expression data (N=",nrow(data1[ data1$nb_genes_filtered < 5000,]),"",sep=""))
print(paste(" we investigated CU across ",nrow(data1[ data1$nb_genes_filtered >= 5000,])," metazoan",sep=""))
print(paste("position between ",nrow(data1)," metazoan species",sep=""))
print(paste("after removal of species lacking gene expression data (N=",nrow(data1[ data1$nb_genes_filtered < 5000,]),"",sep=""))
print(paste("position between ",nrow(data1[ data1$nb_genes_filtered >= 5000,])," metazoan species",sep=""))
print(paste("we investigated CU across ",nrow(data1[ data1$nb_genes_filtered >= 5000,])," metazoan",sep=""))
print(paste("we investigated CU across ",nrow(data1[ data1$nb_genes_filtered >= 5000,])," metazoan",sep=""))
print(paste("we investigated CU across ",nrow(data1[ data1$nb_genes_filtered >= 5000,])," metazoan",sep=""))
data1 = data1[ data1$nb_genes_filtered >= 5000,]
print(paste("clades (",sum(table(data1$clade_group)[c("Mammalia","Aves","Other Tetrapods","Teleostei")]),
" vertebrates, ",sum(table(data1$clade_group)[c("Diptera","Lepidoptera","Coleoptera","Hymenoptera","Other Insects")]),
" insects and ",sum(table(data1$clade_group)[c("Other Metazoans","Nematoda")]),
" other metazoans).",sep=""))
source("figure/figure_main_generator/library_path.R")
data1 = read.delim("data/data1_supp.tab")
rownames(data1) = data1$species
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
##  Abstract
print("Abstract")
##  Introduction
print("Introduction")
##  Non-adaptive processes shape codon usage variations across species
print("Non-adaptive processes are the primary drivers of codon usage variations among metazoans")
print(paste("position between ",nrow(data1)," metazoan species",sep=""))
print(paste("after removal of species lacking gene expression data (N=",nrow(data1[ data1$nb_genes_filtered < 5000,]),"",sep=""))
print(paste("we investigated CU across ",nrow(data1[ data1$nb_genes_filtered >= 5000,])," metazoan",sep=""))
data1 = data1[ data1$nb_genes_filtered >= 5000,]
print(paste("clades (",sum(table(data1$clade_group)[c("Mammalia","Aves","Other Tetrapods","Teleostei")]),
" vertebrates, ",sum(table(data1$clade_group)[c("Diptera","Lepidoptera","Coleoptera","Hymenoptera","Other Insects")]),
" insects and ",sum(table(data1$clade_group)[c("Other Metazoans","Nematoda")]),
" other metazoans).",sep=""))
print(paste("GCi extends from ",round(min(data1$gci),2)," to ",round(max(data1$gci),2),sep=""))
print(paste("GCi range=",round(min(data1$gci),2)," to ",round(max(data1$gci),2),sep=""))
print(paste("(GCi range=",round(min(data1$gci),2)," to ",round(max(data1$gci),2),")",sep=""))
print(paste("GC3 span from ",round(min(data1$gc3),2)," to ",round(max(data1$gc3),2),sep=""))
print(paste("spans from ",round(min(data1$gc3),2)," to ",round(max(data1$gc3),2),sep=""))
print(paste("(GCi range=",round(min(data1$gci),2)," to ",round(max(data1$gci),2),")",sep=""))
print(paste("spans from ",round(min(data1$gc3),2)," to ",round(max(data1$gc3),2),sep=""))
print(paste("Diptera clade (N=",sum(table(data1$clade_group)[c("Diptera")]),")",sep=""))
print(paste("Diptera clade (N=",sum(table(data1$clade_group)[c("Diptera")]),")",sep=""))
print(paste("dipterans (N=",sum(table(data1$clade_group)[c("Diptera")]),")",sep=""))
print(paste("the wider range of GC3 variations (from ",round(min(data1[data1$clade_group == "Diptera",]$gc3),2),"% to ",round(max(data1[data1$clade_group == "Diptera",]$gc3),2),"%).",sep=""))
print(paste("the wider range of GC3 variations (from ",round(min(data1[data1$clade_group == "Diptera",]$gc3),2),
" to ",round(max(data1[data1$clade_group == "Diptera",]$gc3),2),").",sep=""))
print(paste("GC3 and GCi are highly correlated (rho=",round(data1["Homo_sapiens",]$rho_gc3_gci,2),")",sep=""))
print(paste("pronounced in Caenorhabditis elegans (rho=",round(data1["Caenorhabditis_elegans",]$rho_gc3_gci,2),",",sep=""))
data1$std_gci
data1$std_gc3
data1$var_gc3
min(data1$var_gc3)
sqrt(data1$var_gc3)
min(sqrt(data1$var_gc3))
min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods"),]$var_gc3))
min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gc3))
min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gci))
print(paste(" gene GCi and GC3 ($SD_{GCi} > ",min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gci)),
"$, $SD_{GC3} > 0.15$",sep=""))
print(paste(" gene GCi and GC3 ($SD_{GCi} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gci)),2),
"$, $SD_{GC3} > 0.15$",sep=""))
print(paste(" gene GCi and GC3 ($SD_{GCi} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gci)),3),
"$, $SD_{GC3} > 0.15$",sep=""))
"$, $SD_{GC3} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gc3)),3),",sep=""))
print(paste(" gene GCi and GC3 ($SD_{GCi} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gci)),3),
"$, $SD_{GC3} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gc3)),3),sep=""))
# Generate Supplementary Figure 1
source("figure/figure_supp_generator/library_path.R")
# Supplementary Pannel 1 A
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_genes_filtered >= 5000,]
dt_graph = data1
ylabel = "var_gc3"
xlabel = "var_gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
dt_graph[,c(ylabel,xlabel)] = sqrt(dt_graph[,c(ylabel,xlabel)])
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pA = ggplot(dt_graph,aes_string(y=ylabel,x=xlabel,fill="clade_group",label="species")) +
geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=3,pch=21,alpha=0.7) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 5)),
legend.title =  element_text(color="black", size=25, family="economica"),
plot.caption = element_text(hjust = 0.370, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)  + scale_fill_manual("Clades",values=Clade_color) +
ylab("Standard deviation per gene GC3") +
xlab("Standard deviation per gene GCi") +
labs(
caption = substitute(paste(model," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) +
guides(fill = guide_legend(override.aes = list(size=5)),
)
print(pA)
print(paste(" gene GCi and GC3 ($SD_{GCi} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gci)),3),
"$, $SD_{GC3} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gc3)),3),sep=""))
print(paste(" gene GCi and GC3 ($SD_{GCi} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods"),]$var_gci)),3),
"$, $SD_{GC3} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gc3)),3),sep=""))
print(paste(" gene GCi and GC3 ($SD_{GCi} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods"),]$var_gci)),3),
"$, $SD_{GC3} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods"),]$var_gc3)),3),sep=""))
print(paste(" gene GCi and GC3 ($SD_{GCi} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gci)),3),
"$, $SD_{GC3} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gc3)),3),sep=""))
print(paste(" gene GCi and GC3 ($SD_{GCi} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gci)),3),
"$, $SD_{GC3} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gc3)),3),sep=""))
dt_graph = data1
ylabel = "var_gc3"
xlabel = "var_gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
dt_graph[,c(ylabel,xlabel)] = sqrt(dt_graph[,c(ylabel,xlabel)])
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
model_to_use
model_to_use$r2
print(paste("were higly correlated (R2=",model_to_use$r2,")",sep=""))
dt_graph = data1
ylabel = "var_gc3"
xlabel = "var_gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
dt_graph[,c(ylabel,xlabel)] = sqrt(dt_graph[,c(ylabel,xlabel)])
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
print(paste("were higly correlated (R2=",model_to_use$r2,")",sep=""))
print(paste(" gene GCi and GC3 ($SD_{GCi} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gci)),3),
"$, $SD_{GC3} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gc3)),3),sep=""))
source("figure/figure_main_generator/library_path.R")
data1 = read.delim("data/data1_supp.tab")
rownames(data1) = data1$species
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
##  Abstract
print("Abstract")
##  Introduction
print("Introduction")
##  Non-adaptive processes shape codon usage variations across species
print("Non-adaptive processes are the primary drivers of codon usage variations among metazoans")
print(paste("position between ",nrow(data1)," metazoan species",sep=""))
print(paste("after removal of species lacking gene expression data (N=",nrow(data1[ data1$nb_genes_filtered < 5000,]),"",sep=""))
print(paste("we investigated CU across ",nrow(data1[ data1$nb_genes_filtered >= 5000,])," metazoan",sep=""))
data1 = data1[ data1$nb_genes_filtered >= 5000,]
print(paste("clades (",sum(table(data1$clade_group)[c("Mammalia","Aves","Other Tetrapods","Teleostei")]),
" vertebrates, ",sum(table(data1$clade_group)[c("Diptera","Lepidoptera","Coleoptera","Hymenoptera","Other Insects")]),
" insects and ",sum(table(data1$clade_group)[c("Other Metazoans","Nematoda")]),
" other metazoans).",sep=""))
print(paste("(GCi range=",round(min(data1$gci),2)," to ",round(max(data1$gci),2),")",sep=""))
print(paste("spans from ",round(min(data1$gc3),2)," to ",round(max(data1$gc3),2),sep=""))
print(paste("dipterans (N=",sum(table(data1$clade_group)[c("Diptera")]),")",sep=""))
print(paste("the wider range of GC3 variations (from ",round(min(data1[data1$clade_group == "Diptera",]$gc3),2),
" to ",round(max(data1[data1$clade_group == "Diptera",]$gc3),2),").",sep=""))
print(paste("GC3 and GCi are highly correlated (rho=",round(data1["Homo_sapiens",]$rho_gc3_gci,2),")",sep=""))
print(paste("pronounced in Caenorhabditis elegans (rho=",round(data1["Caenorhabditis_elegans",]$rho_gc3_gci,2),",",sep=""))
dt_graph = data1
ylabel = "var_gc3"
xlabel = "var_gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
dt_graph[,c(ylabel,xlabel)] = sqrt(dt_graph[,c(ylabel,xlabel)])
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
print(paste("were higly correlated (R2=",model_to_use$r2,")",sep=""))
print(paste(" gene GCi and GC3 ($SD_{GCi} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gci)),3),
"$, $SD_{GC3} > ",
round(min(sqrt(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Hymenoptera"),]$var_gc3)),3),sep=""))
print(paste("clades from +",round(mean(data1[data1$clade_group == "Diptera",]$expressed_overused_background_POCs)),
"% on average in Diptera to and +",
round(mean(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Teleostei"),]$expressed_overused_background_POCs)),
"% in vertebrates",sep=""))
# Generate Figure 8
source("figure/figure_main_generator/library_path.R")
# Pannel 8 A
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_codon_not_decoded == 0  & data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 ,]
# data1 = data1[data1$clade_group %in% c("Diptera","Lepidoptera"),]
# data1 = data1[data1$species != "Eumeta_japonica",]
dt_graph = data1
ylabel = "g_abond_ag"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
pA =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
geom_abline(linetype="dashed") +
geom_abline(lwd=1,slope = model_to_use$slope, intercept = model_to_use$intercept)+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=24, family="economica",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) + theme(legend.position="none")+
labs(
caption = substitute(paste(model," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
)  + theme(legend.position='none') + scale_fill_manual(values=Clade_color) +
ylab("Average GC of most abundant tRNAs set\n(Unn/Cnn)") +
xlab("Average per gene GCi")
pA
dt_graph = data1
ylabel = "c_duc_ic"
xlabel = "gci"
dt_graph = dt_graph[!is.na(dt_graph[,xlabel]) & !is.na(dt_graph[,ylabel]) & dt_graph$species %in% arbrePhylo$tip.label,]
model_to_use = fitted_model(x=dt_graph[,xlabel],y=dt_graph[,ylabel],label=dt_graph$species,tree=arbrePhylo,display_other=F,pagels_obliged=T)
average_data = data.frame(x=tapply(dt_graph[,xlabel],dt_graph[,ylabel],mean),
y=tapply(dt_graph[,ylabel],dt_graph[,ylabel],mean),
sdx=tapply(dt_graph[,xlabel],dt_graph[,ylabel],sd),
sdy=tapply(dt_graph[,ylabel],dt_graph[,ylabel],sd)
)
dt_graph[,"group"] = tapply(dt_graph[,xlabel],dt_graph[,xlabel]<=median(dt_graph[,xlabel]) , mean)[as.character(dt_graph[,xlabel]<=median(dt_graph[,xlabel]))]
x=dt_graph[dt_graph$group == unique(dt_graph$group)[1],][,ylabel]
y=dt_graph[dt_graph$group == unique(dt_graph$group)[2],][,ylabel]
wilcox.test(x,y)
t.test(x,y)
t.test(x, y, var.equal = FALSE)
pB =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
# geom_boxplot(data=dt_graph , aes_string(x="group", y= ylabel,group="group"),outlier.shape = NA ,pch=21,fill=set_color[5],size=1)+
# geom_point(data=average_data , aes(x=x, y= y, group="moyenne"  ),pch=21,fill=set_color[7],size=8)+
# geom_errorbarh(data=average_data ,aes( xmin=x-sdx,xmax=x+sdx,x=x,y=y,group="moyenne"),height=0.02, size=1,col=set_color[7])+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica",vjust = 1,margin = margin(t = 5)),
legend.title = element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + theme(legend.position='none') + scale_fill_manual("Clades",values=Clade_color) +
ylab("Average GC of most selected codons set\n(nnC/nnU)") +
xlab("Average per gene GCi") +   theme(legend.position = c(0.87, 0.15),
legend.background = element_rect(fill="NA"),
legend.spacing.x = unit(0.1, 'cm'),
legend.spacing.y = unit(0.1, 'cm'),
legend.box.background = element_rect(colour = "black")
)
pB
pB =  ggplot(dt_graph,aes_string(y=ylabel,x=xlabel))  +
# geom_boxplot(data=dt_graph , aes_string(x="group", y= ylabel,group="group"),outlier.shape = NA ,pch=21,fill=set_color[5],size=1)+
# geom_point(data=average_data , aes(x=x, y= y, group="moyenne"  ),pch=21,fill=set_color[7],size=8)+
# geom_errorbarh(data=average_data ,aes( xmin=x-sdx,xmax=x+sdx,x=x,y=y,group="moyenne"),height=0.02, size=1,col=set_color[7])+
geom_point(aes(fill=clade_group),size=4,pch=21,alpha=.8) + theme_bw() + theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=26, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black", size=20, family="economica"),
title =  element_text(color="black", size=20, family="economica"),
text =  element_text(color="black", size=31, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica",vjust = 1,margin = margin(t = 5)),
legend.title = element_text(color="black", size=20, family="economica"),
plot.caption = element_text(hjust = 0.59, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ guides(fill = guide_legend(override.aes = list(size=5))) +
labs(
caption = substitute(paste(model," :",aic," R"^2,"= ",r2,", p-value = ",pvalue,model_non_opti), model_to_use),
title = paste("N = ",nrow(dt_graph)," species",sep="")
) + theme(legend.position='none') + scale_fill_manual("Clades",values=Clade_color) +
ylab("Average GC of most selected codons set\n(nnC/nnU)") +
xlab("Average per gene GCi")
+   theme(legend.position = c(0.87, 0.15),
legend.background = element_rect(fill="NA"),
legend.spacing.x = unit(0.1, 'cm'),
legend.spacing.y = unit(0.1, 'cm'),
legend.box.background = element_rect(colour = "black")
)
pB
