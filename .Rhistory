geom_abline(linetype="dashed") +
geom_point(col=set_color[8],alpha=0.4,size=.51)+
scale_fill_manual(values=set_color) +
scale_color_manual(values=set_color) +
scale_shape_manual(values=c(24,22,21,23,25,20)) + xlab("log10( FPKM+1 )") + ylab("Frequency optimal codons") + theme_bw() + theme(
axis.title.x = element_text(color="black", size=30,family="economica"),
axis.title.y = element_text(color="black", size=0, family="economica"),
axis.text.y =  element_text(color="black", size=0, family="economica"),
axis.text.x =  element_text(color="black", size=25, family="economica"),
title =  element_text(color="black", size=18, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
)+ labs(fill='Categories',color='Categories',shape='',linetype='') +
labs(
caption = substitute(paste("rho = ",rho_aa_fpkm,", p-value = ",pval_aa_fpkm), list(
rho_aa_fpkm = round(spearman_method_aa$estimate, 2),
pval_aa_fpkm = formatC(spearman_method_aa$p.value, format = "e", digits = 0)))
) +
guides(fill = guide_legend(override.aes = list(pch=NA),order = 1),
color = guide_legend(order = 1),
linetype = guide_legend(order = 2),
shape = guide_legend(order = 2,size=NA),
)  +  ylab("") + xlab("GCi rate per gene") + xlim(0.1,.8) +ylim(0.15,1)
pD
jpeg(paste(path_pannel,"p1D.jpg",sep=""),
width = 5000/4.5,  5000/4,res=1000/4)
print(pD)
dev.off()
# Figure 1
imgA = load.image(paste(path_pannel,"p1A.jpg",sep="") )
imgB = load.image(paste(path_pannel,"p1B.jpg",sep="") )
imgC = load.image(paste(path_pannel,"p1C.jpg",sep="") )
imgD = load.image(paste(path_pannel,"p1D.jpg",sep="") )
clade_png<-readPNG(paste(path_require,"clade.png",sep=""))
human<-readPNG(paste(path_require,"human.png",sep=""))
Caenorhabditis_elegans = readPNG(paste(path_require,"Caenorhabditis_elegans.png",sep=""))
aves<-readPNG(paste(path_require,"aves.png",sep=""))
teleostei<-readPNG(paste(path_require,"teleostei.png",sep=""))
monkey<-readPNG(paste(path_require,"monkey.png",sep=""))
fly<-readPNG(paste(path_require,"fly.png",sep=""))
bee<-readPNG(paste(path_require,"bee.png",sep=""))
coleoptera<-readPNG(paste(path_require,"coleoptera.png",sep=""))
lepidoptera<-readPNG(paste(path_require,"lepidoptera.png",sep=""))
{
pdf(file= paste(path_figure,"Figure1.pdf",sep=""), width=6.5, height=5)
m=matrix(rep(NA,10*10), nrow=10)
for(i in 1:10){
m[,i]=rep(1)
}
for(i in 5:10){
m[,i]=c(rep(2,5),rep(3,5))
}
for(i in 6:10){
m[i,]=c(rep(1,4),rep(3,3),rep(4,3))
}
layout(m)
par(mar=c(0, 1, 0, 1))
plot(imgA, axes=FALSE)
mtext("A",at=49.4,adj=-1, side=2, line=1, font=2, cex=1.4,las=2)
xclade=900
yclade=2000
rasterImage(clade_png,xleft=0+xclade, ybottom=850/0.85+yclade, xright=520/.85+xclade, ytop=yclade)
xaxis=700
yaxis=2800
rasterImage(teleostei,xleft=0+xaxis, ybottom=0+yaxis, xright=1100/6+xaxis, ytop=-500/6+yaxis)
xaxis=680
yaxis=2350
rasterImage(aves,xleft=0+xaxis, ybottom=0+yaxis, xright=600/3.5+xaxis, ytop=-750/3.5+yaxis)
xaxis=750
yaxis=1750
rasterImage(monkey,xleft=0+xaxis, ybottom=0+yaxis, xright=900/5+xaxis, ytop=-900/5+yaxis)
xcel=1310
ycel=1120
rasterImage(Caenorhabditis_elegans,xleft=0+xcel, ybottom=0+ycel, xright=1000/5+xcel, ytop=-350/5+ycel)
xaxis=1100
yaxis=800
rasterImage(bee,xleft=0+xaxis, ybottom=0+yaxis, xright=900/5+xaxis, ytop=-700/5+yaxis)
xaxis=1150
yaxis=440
rasterImage(coleoptera,xleft=0+xaxis, ybottom=0+yaxis, xright=1500/10+xaxis, ytop=-900/10+yaxis)
xaxis=1250
yaxis=350
rasterImage(lepidoptera,xleft=0+xaxis, ybottom=0+yaxis, xright=1500/7+xaxis, ytop=-900/7+yaxis)
xaxis=1300
yaxis=150
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/10+xaxis, ytop=-900/10+yaxis)
par(mar=c(0, 1, 2, 0))
plot(imgB, axes=FALSE)
mtext("B",at=49.4,adj=-1.5, side=2, line=1, font=2, cex=1.4,las=2)
par(mar=c(0, 0, 0, 0))
plot(imgC, axes=FALSE)
xhuman=300
yhuman=-60
rasterImage(human,xleft=0+xhuman, ybottom=450/1.9-yhuman, xright=190/1.9+xhuman, ytop=0-yhuman)
mtext("C", adj=0.1,side=2,at=0, line=1, font=2, cex=1.4,las=2)
par(mar=c(0, 0, 0, 2.5))
plot(imgD, axes=FALSE)
xcel=125
ycel=-50
rasterImage(Caenorhabditis_elegans,xleft=0+xcel, ybottom=350/3-ycel, xright=1000/3+xcel, ytop=0-ycel)
dev.off()
}
pA = ggplot(dt_graph,aes(x= obs_codon / sum(obs_codon)*100,y=tRNASE_copies,label=amino_acid)) +
# geom_smooth(formula = y ~ x, method="lm", size=1 , col=set_color[1],se=F,linetype='dashed') +
geom_point(pch=21,size=4,fill=set_color[2]) +
geom_text(nudge_x = .35,size=5,family="economica") + theme_bw() +  theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=25, family="economica"),
axis.text.y =  element_text(color="black", size=22, family="economica"),
axis.text.x =  element_text(color="black", size=22, family="economica"),
title =  element_text(color="black", size=18, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab(paste("Frequency of amino acid weigthed FPKM (%)")) + ylab("tRNA gene copy number") +
labs(
caption = substitute(paste("rho = ",rho_aa_fpkm,", p-value = ",pval_aa_fpkm), list(
rho_aa_fpkm = round(spearman_method_aa$estimate, 2),
pval_aa_fpkm = formatC(spearman_method_aa$p.value, format = "e", digits = 0)))
)
pA
# Generate Figure 2
source("figure/figure_main_generator/library_path.R")
# Pannel 2 A
data3 = read.delim("data/data3_supp.tab")
dt_graph = data3[data3$species == "Caenorhabditis_elegans", ]
spearman_method_aa = cor.test( dt_graph$tRNASE_copies, dt_graph$obs_codon,method="spearman",exact=F)
pA = ggplot(dt_graph,aes(x= obs_codon / sum(obs_codon)*100,y=tRNASE_copies,label=amino_acid)) +
# geom_smooth(formula = y ~ x, method="lm", size=1 , col=set_color[1],se=F,linetype='dashed') +
geom_point(pch=21,size=4,fill=set_color[2]) +
geom_text(nudge_x = .35,size=5,family="economica") + theme_bw() +  theme(
axis.title.x = element_text(color="black", size=26,family="economica"),
axis.title.y = element_text(color="black", size=25, family="economica"),
axis.text.y =  element_text(color="black", size=22, family="economica"),
axis.text.x =  element_text(color="black", size=22, family="economica"),
title =  element_text(color="black", size=18, family="economica"),
legend.text =  element_text(color="black", size=16, family="economica"),
strip.text = element_text(size=15),
plot.caption = element_text(hjust = 0.55, face= "italic", size=20, family="economica"),
plot.caption.position =  "plot"
) + xlab(paste("Frequency of amino acid weigthed FPKM (%)")) + ylab("tRNA gene copy number") +
labs(
caption = substitute(paste("rho = ",rho_aa_fpkm,", p-value = ",pval_aa_fpkm), list(
rho_aa_fpkm = round(spearman_method_aa$estimate, 2),
pval_aa_fpkm = formatC(spearman_method_aa$p.value, format = "e", digits = 0)))
)
pA
jpeg(paste(path_pannel,"p2A.jpg",sep=""), width = 4000/1, height = 4000/1,res=700/1)
print(pA)
dev.off()
# Pannel 2 B
data1 = read.delim("data/data1_supp.tab")
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
data1 = data1[ data1$nb_genes_filtered >= 5000,]
dt_graph = data1
pB = ggplot(dt_graph,aes(y=rho_aa_fpkm,fill=clade_group,x=clade_group))  +
geom_hline(size=1,linetype="dashed",col="red", yintercept = min(dt_graph[dt_graph$rho_aa_fpkm & dt_graph$pval_aa_fpkm < 0.05,]$rho_aa_fpkm) ) +
geom_text (label="p-value < 0.05", y=.4,x="Lepido Diptera",size=5,family="economica",col="red") + geom_boxplot(alpha=.1) +
geom_point(aes(fill=clade_group),size=3,pch=21,alpha=0.7) + theme_bw() + theme(
axis.title.x = element_text(color="black",angle = 50, size=25,family="economica"),
axis.title.y = element_text(color="black", size=22, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black",vjust=1,hjust=1, size=22,angle = 30, family="economica"),
title =  element_text(color="black", size=0, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica")
) + theme(legend.position='none') + scale_fill_manual(values=Clade_color) + ylab("Spearmann Rho")  + xlab("") + ylim(0,1)
pB = ggMarginal(pB, type="histogram",fill=set_color[1])
pB
jpeg(paste(path_pannel,"p2B.jpg",sep=""), width = 4000/1, height = 2500/1,res=400/1)
print(pB)
dev.off()
# Figure 2
imgA = load.image(paste(path_pannel,"p2A.jpg",sep="") )
imgB = load.image(paste(path_pannel,"p2B.jpg",sep="") )
Caenorhabditis_elegans = readPNG(paste(path_require,"Caenorhabditis_elegans.png",sep=""))
{
pdf(file= paste(path_figure,"Figure2.pdf",sep=""), width=11, height=4)
m=matrix(rep(NA,10*100), nrow=10)
for(i in 1:10){
m[i,]=c(rep(1,35),rep(2,65))
}
m
layout(m)
par(mar=c(0, 2, 2, 1))
plot(imgA, axes=FALSE)
mtext("A", adj=0, side=2,at=-200, line=1, font=2, cex=2.2,las=2)
# xcel=540
# ycel=-140
# rasterImage(Caenorhabditis_elegans,xleft=0+xcel, ybottom=350/1.5-ycel, xright=1000/1.4+xcel, ytop=0-ycel)
par(mar=c(0, 0, 0, 0))
plot(imgB, axes=FALSE)
mtext("B",adj=-1, side=2,at=150, line=1, font=2, cex=2.2,las=2)
dev.off()
}
# Generate Supplementary Figure 5
source("figure/figure_supp_generator/library_path.R")
# Supplementary Pannel 5 A
data3_supp = read.delim(paste("data/data9_supp.tab",sep="") , header=T )
data3_supp$clade_group = GTDrift_list_species[data3_supp$species,]$clade_group
data3_supp$from = str_replace_all(data3_supp$from , "from_5prime","From start codons")
data3_supp$from = str_replace_all(data3_supp$from , "from_3prime","From stop codons")
data3_supp$from = factor(data3_supp$from,levels = c("From start codons" , "From stop codons"))
data3_supp$label_facet = paste(data3_supp$clade_group, ", N=",  table(data3_supp[!duplicated(data3_supp$species),]$clade_group)[data3_supp$clade_group])
vector_label = unique(data3_supp$label_facet)
names(vector_label) = unique(data3_supp$clade_group)
data3_supp$label_facet = factor(data3_supp$label_facet , levels = vector_label[levels(data3_supp$clade_group)] )
data3_supp[data3_supp$from == "From start codons",]$group = log10(data3_supp[data3_supp$from == "From start codons",]$group)
data3_supp[data3_supp$from == "From stop codons",]$group = -log10(data3_supp[data3_supp$from == "From stop codons",]$group)
pA = ggplot(data3_supp[data3_supp$nb_genes >= 200,],aes(x = group,group=clade_group,y= gci_count/posi_sites  , label=nb_genes,fill=clade_group,col=clade_group)) +
geom_line(lwd = 0.5,aes(group=species), alpha=0.7) +
facet_wrap(~label_facet + from , ncol=6 ,scale="free_x") +
theme_bw() + theme(
axis.title.x = element_text(color="black", size=25,family="economica"),
axis.title.y = element_text(color="black", size=25, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black",vjust=.5, size=15, family="economica"),
title =  element_text(color="black", size=15, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica"),
strip.text = element_text(family = "economica", size = 14)
) + scale_fill_manual(values = Clade_color)+ scale_color_manual(values = Clade_color) +
scale_x_continuous(breaks=c(-1,-2,-3,-4,1,2,3,4),labels = c(0.01,0.1,1,10,0.01,0.1,1,10)) +
xlab("Distance from start codon or stop codon (kilobase, log scale)") + ylab ("GC introns")  + theme(legend.position='none')
pA
jpeg(paste(path_pannel,"p5A_supp.jpg",sep=""), width = 5500/1, height = 3000/1,res=400/1)
print(pA)
dev.off()
# Supplementary Figure 5
imgA = load.image(paste(path_pannel,"p5A_supp.jpg",sep="") )
human<-readPNG(paste(path_require,"human.png",sep=""))
aves<-readPNG(paste(path_require,"aves.png",sep=""))
teleostei<-readPNG(paste(path_require,"teleostei.png",sep=""))
monkey<-readPNG(paste(path_require,"monkey.png",sep=""))
fly<-readPNG(paste(path_require,"fly.png",sep=""))
bee<-readPNG(paste(path_require,"bee.png",sep=""))
tetrapod<-readPNG(paste(path_require,"tetrapod.png",sep=""))
Caenorhabditis_elegans = readPNG(paste(path_require,"Caenorhabditis_elegans.png",sep=""))
cnidaria = readPNG(paste(path_require,"cnidaria.png",sep=""))
insect = readPNG(paste(path_require,"insect.png",sep=""))
{
pdf(file= paste(path_figure,"Figure5_supp.pdf",sep=""), width=6.75, height=4)
par(mar=c(0, 0, 0, 0))
plot(imgA, axes=FALSE)
# mtext("A", side=2,at=111, line=1, font=2, cex=1,las=2)
xaxis=1000
yaxis=2350
rasterImage(monkey,xleft=0+xaxis, ybottom=0+yaxis, xright=900/5+xaxis, ytop=-900/5+yaxis)
xaxis=2670
yaxis=2350
rasterImage(aves,xleft=0+xaxis, ybottom=0+yaxis, xright=600/3+xaxis, ytop=-750/3+yaxis)
xaxis=4440
yaxis=2380
rasterImage(tetrapod,xleft=0+xaxis, ybottom=0+yaxis, xright=600/3.8+xaxis, ytop=-750/3.8+yaxis)
xcel=900
ycel=1350
rasterImage(Caenorhabditis_elegans,xleft=0+xcel, ybottom=0+ycel, xright=1000/4+xcel, ytop=-350/4+ycel)
xaxis=4370
yaxis=1350
rasterImage(teleostei,xleft=0+xaxis, ybottom=0+yaxis, xright=1100/5+xaxis, ytop=-500/5+yaxis)
xaxis=2670
yaxis=450
rasterImage(bee,xleft=0+xaxis, ybottom=0+yaxis, xright=900/5+xaxis, ytop=-700/5+yaxis)
xaxis=970
yaxis=450
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/8+xaxis, ytop=-900/8+yaxis)
xaxis=4430
yaxis=450
rasterImage(insect,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/7+xaxis, ytop=-1100/7+yaxis)
xcel=2640
ycel=1410
rasterImage(cnidaria,xleft=0+xcel, ybottom=0+ycel, xright=900/4+xcel, ytop=-750/4+ycel)
dev.off()
}
{
pdf(file= paste(path_figure,"Figure5_supp.pdf",sep=""), width=6.75, height=5)
par(mar=c(0, 0, 0, 0))
plot(imgA, axes=FALSE)
# mtext("A", side=2,at=111, line=1, font=2, cex=1,las=2)
xaxis=1000
yaxis=2350
rasterImage(monkey,xleft=0+xaxis, ybottom=0+yaxis, xright=900/5+xaxis, ytop=-900/5+yaxis)
xaxis=2670
yaxis=2350
rasterImage(aves,xleft=0+xaxis, ybottom=0+yaxis, xright=600/3+xaxis, ytop=-750/3+yaxis)
xaxis=4440
yaxis=2380
rasterImage(tetrapod,xleft=0+xaxis, ybottom=0+yaxis, xright=600/3.8+xaxis, ytop=-750/3.8+yaxis)
xcel=900
ycel=1350
rasterImage(Caenorhabditis_elegans,xleft=0+xcel, ybottom=0+ycel, xright=1000/4+xcel, ytop=-350/4+ycel)
xaxis=4370
yaxis=1350
rasterImage(teleostei,xleft=0+xaxis, ybottom=0+yaxis, xright=1100/5+xaxis, ytop=-500/5+yaxis)
xaxis=2670
yaxis=450
rasterImage(bee,xleft=0+xaxis, ybottom=0+yaxis, xright=900/5+xaxis, ytop=-700/5+yaxis)
xaxis=970
yaxis=450
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/8+xaxis, ytop=-900/8+yaxis)
xaxis=4430
yaxis=450
rasterImage(insect,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/7+xaxis, ytop=-1100/7+yaxis)
xcel=2640
ycel=1410
rasterImage(cnidaria,xleft=0+xcel, ybottom=0+ycel, xright=900/4+xcel, ytop=-750/4+ycel)
dev.off()
}
# Generate Supplementary Figure 5
source("figure/figure_supp_generator/library_path.R")
# Supplementary Pannel 5 A
data3_supp = read.delim(paste("data/data9_supp.tab",sep="") , header=T )
data3_supp$clade_group = GTDrift_list_species[data3_supp$species,]$clade_group
data3_supp$from = str_replace_all(data3_supp$from , "from_5prime","From start codons")
data3_supp$from = str_replace_all(data3_supp$from , "from_3prime","From stop codons")
data3_supp$from = factor(data3_supp$from,levels = c("From start codons" , "From stop codons"))
data3_supp$label_facet = paste(data3_supp$clade_group, ", N=",  table(data3_supp[!duplicated(data3_supp$species),]$clade_group)[data3_supp$clade_group])
vector_label = unique(data3_supp$label_facet)
names(vector_label) = unique(data3_supp$clade_group)
data3_supp$label_facet = factor(data3_supp$label_facet , levels = vector_label[levels(data3_supp$clade_group)] )
data3_supp[data3_supp$from == "From start codons",]$group = log10(data3_supp[data3_supp$from == "From start codons",]$group)
data3_supp[data3_supp$from == "From stop codons",]$group = -log10(data3_supp[data3_supp$from == "From stop codons",]$group)
pA = ggplot(data3_supp[data3_supp$nb_genes >= 200,],aes(x = group,group=clade_group,y= gci_count/posi_sites  , label=nb_genes,fill=clade_group,col=clade_group)) +
geom_line(lwd = 0.5,aes(group=species), alpha=0.7) +
facet_wrap(~label_facet + from , ncol=6 ,scale="free_x") +
theme_bw() + theme(
axis.title.x = element_text(color="black", size=25,family="economica"),
axis.title.y = element_text(color="black", size=25, family="economica"),
axis.text.y =  element_text(color="black", size=20, family="economica"),
axis.text.x =  element_text(color="black",vjust=.5, size=15, family="economica"),
title =  element_text(color="black", size=15, family="economica"),
legend.text =  element_text(color="black", size=20, family="economica"),
strip.text = element_text(family = "economica", size = 14)
) + scale_fill_manual(values = Clade_color)+ scale_color_manual(values = Clade_color) +
scale_x_continuous(breaks=c(-1,-2,-3,-4,1,2,3,4),labels = c(0.01,0.1,1,10,0.01,0.1,1,10)) +
xlab("Distance from start codon or stop codon (kilobase, log scale)") + ylab ("GC introns")  + theme(legend.position='none')
pA
jpeg(paste(path_pannel,"p5A_supp.jpg",sep=""), width = 5500/1, height = 4000/1,res=400/1)
print(pA)
dev.off()
# Supplementary Figure 5
imgA = load.image(paste(path_pannel,"p5A_supp.jpg",sep="") )
human<-readPNG(paste(path_require,"human.png",sep=""))
aves<-readPNG(paste(path_require,"aves.png",sep=""))
teleostei<-readPNG(paste(path_require,"teleostei.png",sep=""))
monkey<-readPNG(paste(path_require,"monkey.png",sep=""))
fly<-readPNG(paste(path_require,"fly.png",sep=""))
bee<-readPNG(paste(path_require,"bee.png",sep=""))
tetrapod<-readPNG(paste(path_require,"tetrapod.png",sep=""))
Caenorhabditis_elegans = readPNG(paste(path_require,"Caenorhabditis_elegans.png",sep=""))
cnidaria = readPNG(paste(path_require,"cnidaria.png",sep=""))
insect = readPNG(paste(path_require,"insect.png",sep=""))
{
pdf(file= paste(path_figure,"Figure5_supp.pdf",sep=""), width=6.75, height=5)
par(mar=c(0, 0, 0, 0))
plot(imgA, axes=FALSE)
# mtext("A", side=2,at=111, line=1, font=2, cex=1,las=2)
xaxis=1000
yaxis=2350
rasterImage(monkey,xleft=0+xaxis, ybottom=0+yaxis, xright=900/5+xaxis, ytop=-900/5+yaxis)
xaxis=2670
yaxis=2350
rasterImage(aves,xleft=0+xaxis, ybottom=0+yaxis, xright=600/3+xaxis, ytop=-750/3+yaxis)
xaxis=4440
yaxis=2380
rasterImage(tetrapod,xleft=0+xaxis, ybottom=0+yaxis, xright=600/3.8+xaxis, ytop=-750/3.8+yaxis)
xcel=900
ycel=1350
rasterImage(Caenorhabditis_elegans,xleft=0+xcel, ybottom=0+ycel, xright=1000/4+xcel, ytop=-350/4+ycel)
xaxis=4370
yaxis=1350
rasterImage(teleostei,xleft=0+xaxis, ybottom=0+yaxis, xright=1100/5+xaxis, ytop=-500/5+yaxis)
xaxis=2670
yaxis=450
rasterImage(bee,xleft=0+xaxis, ybottom=0+yaxis, xright=900/5+xaxis, ytop=-700/5+yaxis)
xaxis=970
yaxis=450
rasterImage(fly,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/8+xaxis, ytop=-900/8+yaxis)
xaxis=4430
yaxis=450
rasterImage(insect,xleft=0+xaxis, ybottom=0+yaxis, xright=1200/7+xaxis, ytop=-1100/7+yaxis)
xcel=2640
ycel=1410
rasterImage(cnidaria,xleft=0+xcel, ybottom=0+ycel, xright=900/4+xcel, ytop=-750/4+ycel)
dev.off()
}
## Most constrained sites tend to be enriched in POCs
print("Most constrained sites tend to be enriched in POCs")
data6 = read.delim("data/data6_supp.tab")
dt_analysis = data6[data6$species == "Caenorhabditis_elegans",]
print(paste("the most constrained sites displaying a higher proportion of POCs (on average ",
round(mean(dt_analysis[dt_analysis$type_aa == "POCs" & dt_analysis$categorie == "Highly constrained",]$freq,na.rm=T)*100,1),"% vs ",
round(mean(dt_analysis[dt_analysis$type_aa == "POCs" & dt_analysis$categorie == "Unconstrained",]$freq,na.rm=T)*100,1),"%;",sep=""))
print(paste("Our findings indicate that a majority of the species (",round(sum(data1$constraint_overused_POCs>0)/nrow(data1)*100,),"%) exhibit a positive shift in POC",sep=""))
source("figure/figure_main_generator/library_path.R")
data1 = read.delim("data/data1_supp.tab")
rownames(data1) = data1$species
data1$clade_group = GTDrift_list_species[data1$species,]$clade_group
##  Introduction
print("Introduction")
print(paste("selection intensity across " , nrow(data1) , " metazoan species" , sep = ""))
##  Non-adaptive processes shape codon usage variations across species
print("Non-adaptive processes are the primary drivers of codon usage variations among metazoans")
print(paste("position between ",nrow(data1[ data1$nb_genes_filtered >= 5000,])," metazoan species",sep=""))
print(paste("after removal of species lacking gene expression data (N=",nrow(data1[ data1$nb_genes_filtered < 5000,]),")",sep=""))
data1 = data1[ data1$nb_genes_filtered >= 5000,]
print(paste("clades (",sum(table(data1$clade_group)[c("Mammalia","Aves","Other Tetrapods","Teleostei")]),
" vertebrates, ",sum(table(data1$clade_group)[c("Diptera","Lepidoptera","Coleoptera","Hymenoptera","Other Insects")]),
" insects and ",sum(table(data1$clade_group)[c("Other Metazoans","Nematoda")]),
" other metazoans).",sep=""))
print(paste("GCi extends from ",round(min(data1$gci),2)," to ",round(max(data1$gci),2),sep=""))
print(paste("GC3 span from ",round(min(data1$gc3),2)," to ",round(max(data1$gc3),2),sep=""))
print(paste("Diptera clade (N=",sum(table(data1$clade_group)[c("Diptera")]),")",sep=""))
print(paste("the wider range of GC3 variations (from ",round(min(data1[data1$clade_group == "Diptera",]$gc3),2),"% to ",round(max(data1[data1$clade_group == "Diptera",]$gc3),2),"%).",sep=""))
print(paste("GC3 and GCi are highly correlated (rho=",round(data1["Homo_sapiens",]$rho_gc3_gci,2),")",sep=""))
print(paste("pronounced in Caenorhabditis elegans (rho=",round(data1["Caenorhabditis_elegans",]$rho_gc3_gci,2),",",sep=""))
##  tRNA abundance matches transcriptome requirements
print("tRNA abundance matches transcriptome requirements")
print(paste("but in some cases (",sum(!data1$tRNA_GFF)," species over ",nrow(data1),
") the tRNA are not annotated. We annotated the remaining ",sum(!data1$tRNA_GFF),sep=""))
data7 = read.delim("data/data7_supp.tab")
dt_graph = data7[data7$species == "Drosophila_melanogaster",]
spearman_method_aa = cor.test( dt_graph$prop_abundance_average, dt_graph$prop_transcriptome_count,method="spearman",exact=F)
print(paste(" (rho = ",round(spearman_method_aa$estimate,2),")",sep=""))
dt_graph = data7[data7$species == "Homo_sapiens",]
spearman_method_aa_human = cor.test( dt_graph$gene_copies, dt_graph$prop_transcriptome_count,method="spearman",exact=F)
dt_graph = data7[data7$species == "Drosophila_melanogaster",]
spearman_method_aa_droso = cor.test( dt_graph$gene_copies, dt_graph$prop_transcriptome_count,method="spearman",exact=F)
print(paste(" (rho = ",round(spearman_method_aa$estimate,2),") as well with the gene copy number, (rho = ",round(spearman_method_aa_droso$estimate,2)," and ",round(spearman_method_aa_human$estimate,2)," respectively)",sep=""))
print(paste(" This analysis was conducted across all studied species (N=",nrow(data1)," species )",sep=""))
print(paste("in ",round(sum(data1$pval_aa_fpkm < 0.05)/nrow(data1)*100),"% of the analyzed species",sep=""))
print(paste("with amino acid usage (N=",sum(data1$pval_aa_fpkm < 0.05)," species)",sep=""))
data1 = data1[data1$pval_aa_fpkm < 0.05,]
##  tRNA abundance defines putative-optimal codons
print("tRNA abundance defines putative-optimal codons")
species = "Homo_sapiens"
genome_assembly = GTDrift_list_species[species,]$assembly_accession
taxID = GTDrift_list_species[species,]$NCBI.taxid
path = paste("data/per_species/",species,"_NCBI.taxid",taxID,"/",genome_assembly,sep="")
code = read.delim(paste("data/standard_genetic_code.tab",sep=""))
rownames(code) = code$codon
stop_codon = rownames(code[code$aa_name == "Ter",])
codon_usage = read.delim( paste(path,"/codon_usage_gene_fpkm.tab.gz",sep="") )
codon_usage$intern_stop_codon = rowSums(codon_usage[,stop_codon]) - grepl(paste(stop_codon,collapse = "|"),codon_usage$end_codon)
codon_usage = codon_usage[codon_usage$intern_stop_codon == 0 & codon_usage$start_codon == "ATG" & codon_usage$length_cds %% 3 == 0,]
codon_usage = codon_usage[grepl(paste(stop_codon,collapse = "|"),codon_usage$end_codon),]
codon_usage = codon_usage[order(codon_usage$length_cds,decreasing = T),]
codon_usage = codon_usage[!duplicated(codon_usage$gene_id),]
codon_usage = codon_usage[!is.na(codon_usage$median_fpkm) ,]
codon_usage = codon_usage[codon_usage$median_fpkm != 0 ,]
observation = colSums( codon_usage[3:70] , na.rm = T )
AAC = observation["AAC"]
AAT = observation["AAT"]
print(paste("AAT accounting for ",round(AAT/(AAC+AAT)*100),"% of the occurrences, respectively.",sep=""))
print(paste("we excluded ",sum(data1$nb_codon_not_decoded != 0)," species in which certain",sep=""))
data1 =   data1[ data1$pval_aa_fpkm < 0.05 & data1$nb_genes_filtered >= 5000 & data1$nb_codon_not_decoded == 0,]
data12 = read.delim("data/data12_supp.tab")
data12 = data12[data12$species %in% data1$species,]
list_species = c()
for(species in unique(data12$species)){
aa_present = table(data12[data12$species == species & data12$nb_syn != 1 & data12$abundance != 0 ,]$amino_acid)
aa_present = names(aa_present[aa_present >= 2 ])
if (any(!(aa_present %in% unique(data12[data12$species == species & data12$amino_acid %in% aa_present & data12$POC1, ]$amino_acid)))){
print(species)
list_species=append(list_species,species)
print(aa_present[!(aa_present %in% unique(data12[data12$species == species & data12$amino_acid %in% aa_present & data12$POC1, ]$amino_acid))])
}
}
print(paste(" gene copy number and decodes all synonymous codons (found in N=",length(list_species)," species)",sep=""))
print(paste(" Phe, Asn, Asp, His, Cys and Tyr ( ",100*round(1-1/sum(table(data12[data12$POC2 & data12$species%in%data1$species,]$amino_acid)),3) ,")%",sep=""))
print(paste("In the case of human we are able to identify POC1 for ",length(unique(data12[data12$species == "Homo_sapiens" & data12$POC1,]$amino_acid)),
" amino acid and POC2 for ",length(unique(data12[data12$species == "Homo_sapiens" & data12$POC2,]$amino_acid))," codons.",sep=""))
print(paste("we can define POC1 and POC2 for ",length(unique(data12[data12$species == "Caenorhabditis_elegans" & data12$POC1,]$amino_acid)),
" and ",length(unique(data12[data12$species == "Caenorhabditis_elegans" & data12$POC2,]$amino_acid))," amino acids",sep=""))
print(paste("POC1 are defined for ", round(mean(data1$nb_aa_POC1),1),
" amino acids \textit{per} species (ranging from ",min(data1$nb_aa_POC1)," to ",max(data1$nb_aa_POC1),") and POC2 for ", round(mean(data1$nb_aa_POC2),1),
" amino acids (ranging from ",min(data1$nb_aa_POC2)," to ",max(data1$nb_aa_POC2),")"
,sep="")) # Tyto alba is the only one having 7 because Ile
## Highly expressed genes are enriched in POC1 and POC2
print("Highly expressed genes are enriched in POC1 and POC2")
data5 = read.delim("data/data5_supp.tab")
data5$gene_set = str_replace_all(data5$gene_set,"all,","genes,")
data5[data5$categorie == "POC-matching triplets (POCMT)",]$categorie = "control"
data5[data5$categorie == "Putative optimal codons (POC)",]$categorie = ""
dt_graph = data5[ data5$species == "Caenorhabditis_elegans",]
print(paste("we observed a rise in POC1 from ",round(min(dt_graph[dt_graph$fpkm <= median(dt_graph$fpkm) &
!grepl("control",dt_graph$categorie) &
grepl("POC1",dt_graph$set),]$freq),2)*100,"% to ",
round(dt_graph[!grepl("control",dt_graph$categorie) & dt_graph$fpkm == max(dt_graph$fpkm) & grepl("POC1",dt_graph$set) , ]$freq,2)*100,"% for highly expressed genes"))
print(paste("This analysis was performed for each of the studied species (N=",nrow(data1)," species).",sep=""))
print(paste("For 206 species (",round(table(data1$expressed_overused_background_POCs > 0)["TRUE"]/nrow(data1)*100),"%), the prevalence of POCs",sep=""))
print(paste("The strongest variation is observed in Caenorhabditis elegans (+",
round(data1[data1$species == "Caenorhabditis_elegans",]$expressed_overused_background_POCs),
"%).",sep=""))
print(paste("clades from +",round(mean(data1[data1$clade_group == "Diptera",]$expressed_overused_background_POCs)),
"% on average in Diptera to and +",
round(mean(data1[data1$clade_group %in% c("Mammalia","Aves","Other Tetrapods","Teleostei"),]$expressed_overused_background_POCs)),
"% in vertebrates",sep=""))
print(paste("Not accounting for POC-control variations does not changed the results as it remains positive for ",table(data1$expressed_overused_POCs > 0)["TRUE"]," species ",sep=""))
# print(paste(,sep=""))
## Most constrained sites tend to be enriched in POCs
print("Most constrained sites tend to be enriched in POCs")
data6 = read.delim("data/data6_supp.tab")
dt_analysis = data6[data6$species == "Caenorhabditis_elegans",]
print(paste("the most constrained sites displaying a higher proportion of POCs (on average ",
round(mean(dt_analysis[dt_analysis$type_aa == "POCs" & dt_analysis$categorie == "Highly constrained",]$freq,na.rm=T)*100,1),"% vs ",
round(mean(dt_analysis[dt_analysis$type_aa == "POCs" & dt_analysis$categorie == "Unconstrained",]$freq,na.rm=T)*100,1),"%;",sep=""))
print(paste("Our findings indicate that a majority of the species (",round(sum(data1$constraint_overused_POCs>0)/nrow(data1)*100,),"%) exhibit a positive shift in POC",sep=""))
print(paste("In Diptera we observed a difference reaching ",round(max(data1[data1$clade_group == "Diptera",]$constraint_overused_POCs),1),
"% (with an average of ",round(mean(data1[data1$clade_group == "Diptera",]$constraint_overused_POCs),1),
"%).",sep=""))
